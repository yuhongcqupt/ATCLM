/** Copyright 2015 The MathWorks, Inc. */
//>>built
require({cache:{"MW/remote/MessageService":function(){define("dojo/_base/lang dojo/aspect ./messageserviceimpl/MessageServiceAsync ./messageserviceimpl/MessageServiceBase ./messageserviceimpl/MessageServiceReqResp ./Remote".split(" "),function(l,h,f,b,a,c){var d=new b;b={messageService:d,subscribe:l.hitch(d,"subscribe"),unsubscribe:l.hitch(d,"unsubscribe"),publish:l.hitch(d,"publish"),start:l.hitch(d,"start"),stop:l.hitch(d,"stop"),isRunning:l.hitch(d,"isStarted"),isStarted:l.hitch(d,"isStarted"),
isConnected:l.hitch(d,"isConnected"),isFatallyDisconnected:l.hitch(d,"isFatallyDisconnected"),isDisconnected:l.hitch(d,"isDisconnected"),setLatency:l.hitch(d,"setLatency"),setErrorRate:l.hitch(d,"setErrorRate"),onConnected:function(){},onDisconnected:function(){},onReconnected:function(){},onFatallyDisconnected:function(){},onNotConnected:function(){},handleMessage:l.hitch(d,"handleMessage"),internalMotwDisableStart:function(){this._startFunction=this.start;this.start=function(){}},internalMotwEnableStart:function(){this._startFunction&&
(this.start=this._startFunction,this._startFunction=null)}};h.after(d,"onConnected",l.hitch(b,"onConnected"),!0);h.after(d,"onDisconnected",l.hitch(b,"onDisconnected"),!0);h.after(d,"onReconnected",l.hitch(b,"onReconnected"),!0);h.after(d,"onFatallyDisconnected",l.hitch(b,"onFatallyDisconnected"),!0);h.after(d,"onNotConnected",l.hitch(b,"onNotConnected"),!0);var g=c.enableServerOnWorkerAsync;c.enableServerOnWorkerAsync=function(){g();d.setDelegate(new f(c))};var e=c.disableServerOnWorkerAsync;c.disableServerOnWorkerAsync=
function(){e();d.setDelegate(new a(c,d))};c.isServerOnWorkerAsyncEnabled()?c.enableServerOnWorkerAsync():c.disableServerOnWorkerAsync();return b})},"MW/remote/messageserviceimpl/MessageServiceAsync":function(){define("dojo/_base/declare dojo/aspect dojo/json dojo/Deferred dojox/cometd/cometd dojox/cometd/AckExtension MW/Log ../iframeproxy/IframeProxyClient".split(" "),function(l,h,f,b,a,c,d,g){var e;a.JSON.toJSON=f.stringify;a.JSON.fromJSON=f.parse;var m=0,n=0,p={};setInterval(function(){m+=200;Object.keys(p).forEach(function(a){var b=
p[a];b.execTime<=m&&(b.func(),delete p[a])})},200);var k=function(b,k){var d=new a.LongPollingTransport,d=a.Transport.derive(d);d.xhrSend=function(a){var b=k.sendMessage(a.body,a.url,{headers:a.headers});b.then(a.onSuccess,function(b){a.onError(b,b)});return{abort:function(){b.cancel()}}};var f=new a.Cometd(b),h=a.Utils.setTimeout;a.Utils.setTimeout=function(a,b,e){if(0===e)return h(a,b,e);n+=1;p[n]={func:function(){try{b()}catch(a){f._debug("Exception invoking timed function",b,a)}},execTime:m+e};
return n};a.Utils.clearTimeout=function(a){delete p[a]};a.WebSocket=g.WebSocket;g.WebSocket.proxyClient=k;f.registerExtension("ack",new c);a.WebSocket&&(e.enableWebsocket||0<=location.search.indexOf("websocket\x3don"))&&f.registerTransport("websocket",new a.WebSocketTransport,0);f.registerTransport("long-polling",d,1);return f};e=l([],{BASE_PREFIX:"/matlab",BASE_END_POINT:"messageservice/async",logCometdLifecycle:!1,logCometdSubscriptions:!1,constructor:function(a,b,e,c){this.remote=a;this.constructCometD=
b||k;this.cometdProperties=c||{connectTimeout:5E3,maxBackoff:1E4,logLevel:"info",maxNetworkDelay:2E4,appendMessageTypeToURL:!1,autoBatch:!0};this.workerProxyAsyncClient=e||new g("remoteWorkerAsyncProducer");var m=this;h.after(this.workerProxyAsyncClient,"onError",function(a){m.cometd&&(m.logCometdLifecycle&&d.info("MessageServiceAsync disconnecting cometd due to IFrame error."),m.cometd.disconnect());m.onConnectionError(a)},!0);this.subscriptions={};this.recentMessages=[];this._deferredCleanupFunction=
function(){m._deferredCleanup=!1;m.recentMessages=[]}},onMessage:function(a){},onConnectionError:function(a){},connect:function(){this.routingHost=e.workerHostOverride||this.remote.getWorkerRoutingHost();this.routingKey=this.remote.getWorkerRoutingKey();this.computeToken=this.remote.getComputeSessionId();this.workerProxyAsyncClient.setRemotePageHost(this.routingHost,this.routingKey,this.computeToken);var a=this.constructCometD("messageService",this.workerProxyAsyncClient);this.cometd=a;this.logCometdLifecycle&&
d.info("MessageServiceAsync constructing new cometd instance.");var c=this._createOneShotMessagePromise("/meta/handshake"),k=this,m=new b;c.then(function(b){k.logCometdLifecycle&&d.info("MessageServiceAsync cometd handshake successful.",b,a.getClientId(),a);a.isDisconnected()?(d.error("MessageServiceAsync cometd handshake successful but still disconnected!"),a.disconnect(),m.reject(b)):m.resolve(b)},function(b){k.logCometdLifecycle&&d.info("MessageServiceAsync disconnecting cometd due to handshake failure.",
b,a.getClientId(),a);a.disconnect();m.reject(b)});this.cometdProperties.url=this._getEndpoint();a.init(this.cometdProperties);return m.promise},disconnect:function(){this.logCometdLifecycle&&d.info("MessageServiceAsync disconnecting cometd due to disconnect call.",this.cometd.getClientId());var a=this._createOneShotMessagePromise("/meta/disconnect");this.cometd.disconnect();return a},cleanup:function(){this.cometd&&(this.logCometdLifecycle&&d.info("MessageServiceAsync disconnecting cometd due to cleanup call.",
this.cometd,this.cometd&&this.cometd.getClientId()),this.cometd.disconnect(),this.cometd=null)},delegateConnected:function(){return this.cometd?!this.cometd.isDisconnected():!1},doPublish:function(a,b){var e=this._createOneShotMessagePromise("/meta/publish");this.cometd.publish(this._getRequestChannel(a),b);return e},doSubscribe:function(a){this.logCometdSubscriptions&&d.info("MessageServiceAsync subscribing cometd to channel: "+a);var b=this._createOneShotMessagePromise("/meta/subscribe");this.subscriptions[a]=
this.cometd.subscribe(this._getRequestChannel(a),this,this._handleCometResponse);return b},doUnsubscribe:function(a){if(this.subscriptions[a]){this.logCometdSubscriptions&&d.info("MessageServiceAsync unsubscribing cometd from channel: "+a);var e=this._createOneShotMessagePromise("/meta/unsubscribe");this.cometd.unsubscribe(this.subscriptions[a]);delete this.subscriptions[a];return e}return(new b).resolve({successful:!0})},doStartBatch:function(){this.cometd.startBatch()},doEndBatch:function(){this.cometd.endBatch()},
doSetLatency:function(a){this.workerProxyAsyncClient.setLatency(a)},doSetErrorRate:function(a){this.workerProxyAsyncClient.setErrorRate(a)},_handleCometResponse:function(a){if(this._shouldHandleMessage(a))this.onMessage(this._stripBasePrefixAndConvertToJson(a))},_shouldHandleMessage:function(a){return!a.id&&0>this.recentMessages.indexOf(a)?(this.recentMessages.push(a),this._deferRecentMessagesCleanup(),!0):!1},_deferRecentMessagesCleanup:function(){this._deferredCleanup||(this._deferredCleanup=setTimeout(this._deferredCleanupFunction,
0))},_createOneShotMessagePromise:function(a){var e=new b;this._addOneShotListener(a,function(a){a.successful?e.resolve(a):(d.warn("Message failed: ",a),e.reject(a))});return e.promise},_addOneShotListener:function(a,b){var e=this,c=this.cometd,k;k=this.cometd.addListener(a,function(a){c.removeListener(k);b.apply(e,arguments)})},_getEndpoint:function(){return this.routingHost+this.BASE_END_POINT+"?routingkey\x3d"+this.routingKey},_getRequestChannel:function(a){return this.BASE_PREFIX+a},_stripBasePrefixAndConvertToJson:function(a){return{channel:a.channel.substring(this.BASE_PREFIX.length),
data:a.data}}});e.enableWebsocket=!1;e.workerHostOverride=!1;return e})},"dojox/cometd/cometd":function(){define(function(){var l=this.org=this.org||{};l.cometd={};l.cometd.JSON={};l.cometd.JSON.toJSON=l.cometd.JSON.fromJSON=function(h){throw"Abstract";};l.cometd.Utils={};l.cometd.Utils.isString=function(h){return void 0===h||null===h?!1:"string"===typeof h||h instanceof String};l.cometd.Utils.isArray=function(h){return void 0===h||null===h?!1:h instanceof Array};l.cometd.Utils.inArray=function(h,
f){for(var b=0;b<f.length;++b)if(h===f[b])return b;return-1};l.cometd.Utils.setTimeout=function(h,f,b){return window.setTimeout(function(){try{f()}catch(a){h._debug("Exception invoking timed function",f,a)}},b)};l.cometd.Utils.clearTimeout=function(h){window.clearTimeout(h)};l.cometd.TransportRegistry=function(){var h=[],f={};this.getTransportTypes=function(){return h.slice(0)};this.findTransportTypes=function(b,a,c){for(var d=[],g=0;g<h.length;++g){var e=h[g];!0===f[e].accept(b,a,c)&&d.push(e)}return d};
this.negotiateTransport=function(b,a,c,d){for(var g=0;g<h.length;++g)for(var e=h[g],m=0;m<b.length;++m)if(e===b[m]){var n=f[e];if(!0===n.accept(a,c,d))return n}return null};this.add=function(b,a,c){for(var d=!1,g=0;g<h.length;++g)if(h[g]===b){d=!0;break}d||("number"!==typeof c?h.push(b):h.splice(c,0,b),f[b]=a);return!d};this.find=function(b){for(var a=0;a<h.length;++a)if(h[a]===b)return f[b];return null};this.remove=function(b){for(var a=0;a<h.length;++a)if(h[a]===b)return h.splice(a,1),a=f[b],delete f[b],
a;return null};this.clear=function(){h=[];f={}};this.reset=function(){for(var b=0;b<h.length;++b)f[h[b]].reset()}};l.cometd.Transport=function(){var h,f;this.registered=function(b,a){h=b;f=a};this.unregistered=function(){f=h=null};this._debug=function(){f._debug.apply(f,arguments)};this._mixin=function(){return f._mixin.apply(f,arguments)};this.getConfiguration=function(){return f.getConfiguration()};this.getAdvice=function(){return f.getAdvice()};this.setTimeout=function(b,a){return l.cometd.Utils.setTimeout(f,
b,a)};this.clearTimeout=function(b){l.cometd.Utils.clearTimeout(b)};this.convertToMessages=function(b){if(l.cometd.Utils.isString(b))try{return l.cometd.JSON.fromJSON(b)}catch(a){throw this._debug("Could not convert to JSON the following string",'"'+b+'"'),a;}if(l.cometd.Utils.isArray(b))return b;if(void 0===b||null===b)return[];if(b instanceof Object)return[b];throw"Conversion Error "+b+", typeof "+typeof b;};this.accept=function(b,a,c){throw"Abstract";};this.getType=function(){return h};this.send=
function(b,a){throw"Abstract";};this.reset=function(){this._debug("Transport",h,"reset")};this.abort=function(){this._debug("Transport",h,"aborted")};this.toString=function(){return this.getType()}};l.cometd.Transport.derive=function(h){function f(){}f.prototype=h;return new f};l.cometd.RequestTransport=function(){function h(a){for(;0<n.length;){var b=n[0],e=b[0],b=b[1];if(e.url===a.url&&e.sync===a.sync)n.shift(),a.messages=a.messages.concat(e.messages),this._debug("Coalesced",e.messages.length,"messages from request",
b.id);else break}}function f(a,b){this.transportSend(a,b);b.expired=!1;if(!a.sync){var e=this.getConfiguration().maxNetworkDelay,c=e;!0===b.metaConnect&&(c+=this.getAdvice().timeout);this._debug("Transport",this.getType(),"waiting at most",c,"ms for the response, maxNetworkDelay",e);var d=this;b.timeout=this.setTimeout(function(){b.expired=!0;b.xhr&&b.xhr.abort();var e="Request "+b.id+" of transport "+d.getType()+" exceeded "+c+" ms max network delay";d._debug(e);d.complete(b,!1,b.metaConnect);a.onFailure(b.xhr,
a.messages,"timeout",e)},c)}}function b(a){var b=++g,e={id:b,metaConnect:!1};m.length<this.getConfiguration().maxConnections-1?(m.push(e),f.call(this,a,e)):(this._debug("Transport",this.getType(),"queueing request",b,"envelope",a),n.push([a,e]))}function a(a,e){var c=l.cometd.Utils.inArray(a,m);0<=c&&m.splice(c,1);if(0<n.length){var c=n.shift(),d=c[0],g=c[1];this._debug("Transport dequeued request",g.id);if(e)this.getConfiguration().autoBatch&&h.call(this,d),b.call(this,d),this._debug("Transport completed request",
a.id,d);else{var f=this;this.setTimeout(function(){f.complete(g,!1,g.metaConnect);d.onFailure(g.xhr,d.messages,"error","Previous request failed")},0)}}}var c=new l.cometd.Transport,d=l.cometd.Transport.derive(c),g=0,e=null,m=[],n=[];d.complete=function(b,c,d){if(d){b=b.id;this._debug("Transport",this.getType(),"metaConnect complete, request",b);if(null!==e&&e.id!==b)throw"Longpoll request mismatch, completing request "+b;e=null}else a.call(this,b,c)};d.transportSend=function(a,b){throw"Abstract";
};d.transportSuccess=function(a,b,e){if(!b.expired)if(this.clearTimeout(b.timeout),this.complete(b,!0,b.metaConnect),e&&0<e.length)a.onSuccess(e);else a.onFailure(b.xhr,a.messages,"Empty HTTP response")};d.transportFailure=function(a,b,e,c){b.expired||(this.clearTimeout(b.timeout),this.complete(b,!1,b.metaConnect),a.onFailure(b.xhr,a.messages,e,c))};d.send=function(a,c){if(c){if(null!==e)throw"Concurrent metaConnect requests not allowed, request id\x3d"+e.id+" not yet completed";var d=++g;this._debug("Transport",
this.getType(),"metaConnect send, request",d,"envelope",a);d={id:d,metaConnect:!0};f.call(this,a,d);e=d}else b.call(this,a)};d.abort=function(){c.abort();for(var a=0;a<m.length;++a){var b=m[a];this._debug("Aborting request",b);b.xhr&&b.xhr.abort()}e&&(this._debug("Aborting metaConnect request",e),e.xhr&&e.xhr.abort());this.reset()};d.reset=function(){c.reset();e=null;m=[];n=[]};return d};l.cometd.LongPollingTransport=function(){var h=new l.cometd.RequestTransport,f=l.cometd.Transport.derive(h),b=
!0;f.accept=function(a,c,d){return b||!c};f.xhrSend=function(a){throw"Abstract";};f.transportSend=function(a,c){this._debug("Transport",this.getType(),"sending request",c.id,"envelope",a);var d=this;try{var g=!0;c.xhr=this.xhrSend({transport:this,url:a.url,sync:a.sync,headers:this.getConfiguration().requestHeaders,body:l.cometd.JSON.toJSON(a.messages),onSuccess:function(e){d._debug("Transport",d.getType(),"received response",e);var g=!1;try{var f=d.convertToMessages(e);0===f.length?(b=!1,d.transportFailure(a,
c,"no response",null)):(g=!0,d.transportSuccess(a,c,f))}catch(k){d._debug(k),g||(b=!1,d.transportFailure(a,c,"bad response",k))}},onError:function(e,f){b=!1;g?d.setTimeout(function(){d.transportFailure(a,c,e,f)},0):d.transportFailure(a,c,e,f)}});g=!1}catch(e){b=!1,this.setTimeout(function(){d.transportFailure(a,c,"error",e)},0)}};f.reset=function(){h.reset();b=!0};return f};l.cometd.CallbackPollingTransport=function(){var h=new l.cometd.RequestTransport,h=l.cometd.Transport.derive(h);h.accept=function(f,
b,a){return!0};h.jsonpSend=function(f){throw"Abstract";};h.transportSend=function(f,b){for(var a=this,c=0,d=f.messages.length,g=[];0<d;){var e=l.cometd.JSON.toJSON(f.messages.slice(c,c+d)),e=f.url.length+encodeURI(e).length;if(2E3<e){if(1===d){var m="Bayeux message too big ("+e+" bytes, max is 2000) for transport "+this.getType();this.setTimeout(function(){a.transportFailure(f,b,"error",m)},0);return}--d}else g.push(d),c+=d,d=f.messages.length-c}var n=f;if(1<g.length){c=0;d=g[0];this._debug("Transport",
this.getType(),"split",f.messages.length,"messages into",g.join(" + "));n=this._mixin(!1,{},f);n.messages=f.messages.slice(c,d);n.onSuccess=f.onSuccess;n.onFailure=f.onFailure;for(e=1;e<g.length;++e){var h=this._mixin(!1,{},f),c=d,d=d+g[e];h.messages=f.messages.slice(c,d);h.onSuccess=f.onSuccess;h.onFailure=f.onFailure;this.send(h,b.metaConnect)}}this._debug("Transport",this.getType(),"sending request",b.id,"envelope",n);try{var k=!0;this.jsonpSend({transport:this,url:n.url,sync:n.sync,headers:this.getConfiguration().requestHeaders,
body:l.cometd.JSON.toJSON(n.messages),onSuccess:function(e){var c=!1;try{var d=a.convertToMessages(e);0===d.length?a.transportFailure(n,b,"no response"):(c=!0,a.transportSuccess(n,b,d))}catch(g){a._debug(g),c||a.transportFailure(n,b,"bad response",g)}},onError:function(e,c){k?a.setTimeout(function(){a.transportFailure(n,b,e,c)},0):a.transportFailure(n,b,e,c)}});k=!1}catch(u){this.setTimeout(function(){a.transportFailure(n,b,"error",u)},0)}};return h};l.cometd.WebSocketTransport=function(){function h(){var a=
d.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",a);var b=this,e=null,c=d.getConfiguration().connectTimeout;0<c&&(e=this.setTimeout(function(){e=null;k||(b._debug("Transport",b.getType(),"timed out while connecting to URL",a,":",c,"ms"),b.onClose(1002,"Connect Timeout"))},c));var g=new l.cometd.WebSocket(a),m=function(a){var c=a?a.code:1E3;a=a?a.reason:void 0;b._debug("WebSocket closed",c,"/",a,g);e&&(b.clearTimeout(e),e=null);if(g!==p)b._debug("Ignoring close event, WebSocket",
p);else b.onClose(c,a)};g.onopen=function(){b._debug("WebSocket opened",g);e&&(b.clearTimeout(e),e=null);if(g!==p)b._debug("Ignoring open event, WebSocket",p);else b.onOpen()};g.onclose=m;g.onerror=function(){m({code:1002})};g.onmessage=function(a){b._debug("WebSocket message",a,g);if(g!==p)b._debug("Ignoring message event, WebSocket",p);else b.onMessage(a)};p=g;this._debug("Transport",this.getType(),"configured callbacks on",g)}function f(a,b){var e=l.cometd.JSON.toJSON(a.messages);p.send(e);this._debug("Transport",
this.getType(),"sent",a,"metaConnect \x3d",b);var c=e=this.getConfiguration().maxNetworkDelay;b&&(c+=this.getAdvice().timeout,u=!0);for(var d=[],g=0;g<a.messages.length;++g){var m=a.messages[g];if(m.id){d.push(m.id);var k=p;n[m.id]=this.setTimeout(function(){k&&k.close(1E3,"Timeout")},c)}}this._debug("Transport",this.getType(),"waiting at most",c,"ms for messages",d,"maxNetworkDelay",e,", timeouts:",n)}function b(a,b){try{null===p?h.call(this):k&&f.call(this,a,b)}catch(e){var c=p;this.setTimeout(function(){a.onFailure(c,
a.messages,"error",e)},0)}}var a=new l.cometd.Transport,c=l.cometd.Transport.derive(a),d,g=!0,e=!1,m={},n={},p=null,k=!1,u=!1,r;c.onOpen=function(){this._debug("Transport",this.getType(),"opened",p);e=k=!0;this._debug("Sending pending messages",m);for(var a in m){var b=m[a],c=b[0],b=b[1];r=c.onSuccess;f.call(this,c,b)}};c.onMessage=function(a){this._debug("Transport",this.getType(),"received websocket message",a,p);var b=!1;a=this.convertToMessages(a.data);for(var e=[],c=0;c<a.length;++c){var d=a[c];
if((/^\/meta\//.test(d.channel)||void 0===d.data)&&d.id){e.push(d.id);var g=n[d.id];g&&(this.clearTimeout(g),delete n[d.id],this._debug("Transport",this.getType(),"removed timeout for message",d.id,", timeouts",n))}"/meta/connect"===d.channel&&(u=!1);"/meta/disconnect"===d.channel&&!u&&(b=!0)}c=!1;for(d=0;d<e.length;++d){var k=e[d],f;for(f in m){var g=f.split(","),h=l.cometd.Utils.inArray(k,g);if(0<=h){c=!0;g.splice(h,1);k=m[f][0];h=m[f][1];delete m[f];0<g.length&&(m[g.join(",")]=[k,h]);break}}}c&&
this._debug("Transport",this.getType(),"removed envelope, envelopes",m);r.call(this,a);b&&p.close(1E3,"Disconnect")};c.onClose=function(a,b){this._debug("Transport",this.getType(),"closed",a,b,p);g=e;for(var c in n)this.clearTimeout(n[c]);n={};for(var d in m)c=m[d][0],m[d][1]&&(u=!1),c.onFailure(p,c.messages,"closed "+a+"/"+b);m={};null!==p&&k&&p.close(1E3,"Close");k=!1;p=null};c.registered=function(b,e){a.registered(b,e);d=e};c.accept=function(a,b,e){return g&&!!l.cometd.WebSocket&&!1!==d.websocketEnabled};
c.send=function(a,e){this._debug("Transport",this.getType(),"sending",a,"metaConnect \x3d",e);for(var c=[],d=0;d<a.messages.length;++d){var g=a.messages[d];g.id&&c.push(g.id)}m[c.join(",")]=[a,e];this._debug("Transport",this.getType(),"stored envelope, envelopes",m);b.call(this,a,e)};c.abort=function(){a.abort();if(null!==p)try{p.close(1001)}catch(b){this._debug(b)}this.reset()};c.reset=function(){a.reset();null!==p&&k&&p.close(1E3,"Reset");g=!0;e=!1;n={};m={};p=null;k=!1;r=null};return c};l.cometd.Cometd=
function(h){function f(a){return l.cometd.Utils.isString(a)}function b(a){return void 0===a||null===a?!1:"function"===typeof a}function a(a,e){if(window.console){var c=window.console[a];b(c)&&c.apply(window.console,e)}}function c(){for(var a in F)for(var b=F[a],e=b.length-1;0<=e;--e){var c=b[e];c&&!c.listener&&(b.splice(e,1),q._debug("Removed subscription",c,"for channel",a))}}function d(a){H!==a&&(q._debug("Status",H,"-\x3e",a),H=a)}function g(){return"disconnecting"===H||"disconnected"===H}function e(a,
e,c,d,g){try{return e.call(a,d)}catch(k){q._debug("Exception during execution of extension",c,k);a=q.onExtensionException;if(b(a)){q._debug("Invoking extension exception callback",c,k);try{a.call(q,k,c,g,d)}catch(m){q._info("Exception during execution of exception callback in extension",c,m)}}return d}}function m(a){for(var c=0;c<y.length&&!(void 0===a||null===a);++c){var d=y[c],g=d.extension.outgoing;b(g)&&(d=e(d.extension,g,d.name,a,!0),a=void 0===d?a:d)}return a}function n(a,e){var c=F[a];if(c&&
0<c.length)for(var d=c.length-1;0<=d;--d){var g=c[d];try{g.callback.call(g.scope,e)}catch(k){q._debug("Exception during notification",g,e,k);var m=q.onListenerException;if(b(m)){q._debug("Invoking listener exception callback",g,k);try{m.call(q,k,g.handle,g.listener,e)}catch(f){q._info("Exception during execution of listener callback",g,f)}}}}}function p(a,b){n(a,b);for(var e=a.split("/"),c=e.length-1,d=c;0<d;--d){var g=e.slice(0,d).join("/")+"/*";d===c&&n(g,b);g+="*";n(g,b)}}function k(){null!==O&&
l.cometd.Utils.clearTimeout(O);O=null}function u(a){k();var b=z.interval+x;q._debug("Function scheduled in",b,"ms, interval \x3d",z.interval,"backoff \x3d",x,a);O=l.cometd.Utils.setTimeout(q,a,b)}function r(a,e,c,d){for(var g=0;g<e.length;++g){var k=e[g];k.id=""+ ++ea;I&&(k.clientId=I);var f=void 0;b(k._callback)&&(f=k._callback,delete k._callback);k=m(k);void 0!==k&&null!==k?(e[g]=k,f&&(P[k.id]=f)):e.splice(g--,1)}0!==e.length&&(g=t.url,t.appendMessageTypeToURL&&(g.match(/\/$/)||(g+="/"),d&&(g+=
d)),a={url:g,sync:a,messages:e,onSuccess:function(a){try{V.call(q,a)}catch(b){q._debug("Exception during handling of messages",b)}},onFailure:function(a,b,e,c){try{Q.call(q,a,b,e,c)}catch(d){q._debug("Exception during handling of failure",d)}}},q._debug("Send",a),B.send(a,c))}function v(a){0<G||!0===L?J.push(a):r(!1,[a],!1)}function s(){var a=J;J=[];0<a.length&&r(!1,a,!1)}function w(){d("connecting");u(function(){if(!g()){var a={channel:"/meta/connect",connectionType:B.getType()};R||(a.advice={timeout:0});
d("connecting");q._debug("Connect sent",a);r(!1,[a],!0,"connect");d("connected")}})}function K(a){a&&(z=q._mixin(!1,{},t.advice,a),q._debug("New advice",z))}function C(a){k();a&&B.abort();I=null;d("disconnected");x=G=0;0<J.length&&(Q.call(q,void 0,J,"error","Disconnected"),J=[])}function N(a){I=null;c();g()?(A.reset(),K(t.advice)):K(q._mixin(!1,z,{reconnect:"retry"}));G=0;L=!0;S=a;a=A.findTransportTypes("1.0",M,t.url);var b=q._mixin(!1,{},S,{version:"1.0",minimumVersion:"0.9",channel:"/meta/handshake",
supportedConnectionTypes:a,advice:{timeout:z.timeout,interval:z.interval}});B=A.negotiateTransport(a,"1.0",M,t.url);q._debug("Initial transport is",B.getType());d("handshaking");q._debug("Handshake sent",b);r(!1,[b],!1,"handshake")}function D(){d("handshaking");L=!0;u(function(){N(S)})}function E(a){p("/meta/handshake",a);p("/meta/unsuccessful",a);!g()&&"none"!==z.reconnect?(x<t.maxBackoff&&(x+=t.backoffIncrement),D()):C(!1)}function U(a){p("/meta/connect",a);p("/meta/unsuccessful",a);a=g()?"none":
z.reconnect;switch(a){case "retry":w();x<t.maxBackoff&&(x+=t.backoffIncrement);break;case "handshake":A.reset();x=0;D();break;case "none":C(!1);break;default:throw"Unrecognized advice action"+a;}}function W(a){C(!0);p("/meta/disconnect",a);p("/meta/unsuccessful",a)}function X(a){p("/meta/subscribe",a);p("/meta/unsuccessful",a)}function Y(a){p("/meta/unsubscribe",a);p("/meta/unsuccessful",a)}function Z(a){var e=P[a.id];b(e)&&(delete P[a.id],e.call(q,a))}function $(a){Z(a);p("/meta/publish",a);p("/meta/unsuccessful",
a)}function aa(a){for(var c=0;c<y.length&&!(void 0===a||null===a);++c){var d=y[t.reverseIncomingExtensions?y.length-1-c:c],k=d.extension.incoming;b(k)&&(d=e(d.extension,k,d.name,a,!1),a=void 0===d?a:d)}if(!(void 0===a||null===a))switch(K(a.advice),a.channel){case "/meta/handshake":if(a.successful){I=a.clientId;c=A.negotiateTransport(a.supportedConnectionTypes,a.version,M,t.url);if(null===c)throw"Could not negotiate transport with server; client "+A.findTransportTypes(a.version,M,t.url)+", server "+
a.supportedConnectionTypes;B!==c&&(q._debug("Transport",B,"-\x3e",c),B=c);L=!1;s();a.reestablish=T;T=!0;p("/meta/handshake",a);a=g()?"none":z.reconnect;switch(a){case "retry":x=0;w();break;case "none":C(!1);break;default:throw"Unrecognized advice action "+a;}}else E(a);break;case "/meta/connect":if(R=a.successful)switch(p("/meta/connect",a),a=g()?"none":z.reconnect,a){case "retry":x=0;w();break;case "none":C(!1);break;default:throw"Unrecognized advice action "+a;}else U(a);break;case "/meta/disconnect":a.successful?
(C(!1),p("/meta/disconnect",a)):W(a);break;case "/meta/subscribe":a.successful?p("/meta/subscribe",a):X(a);break;case "/meta/unsubscribe":a.successful?p("/meta/unsubscribe",a):Y(a);break;default:void 0===a.successful?void 0!==a.data&&null!==a.data?p(a.channel,a):q._debug("Unknown message",a):a.successful?(Z(a),p("/meta/publish",a)):$(a)}}function ba(a){if(a=F[a])for(var b=0;b<a.length;++b)if(a[b])return!0;return!1}function ca(a,e){var c={scope:a,method:e};if(b(a))c.scope=void 0,c.method=a;else if(f(e)){if(!a)throw"Invalid scope "+
a;c.method=a[e];if(!b(c.method))throw"Invalid callback "+e+" for scope "+a;}else if(!b(e))throw"Invalid callback "+e;return c}function da(a,b,e,c){b=ca(b,e);q._debug("Adding listener on",a,"with scope",b.scope,"and callback",b.method);c={channel:a,scope:b.scope,callback:b.method,listener:c};b=F[a];b||(b=[],b.subscriptionCounter=0,F[a]=b);b.push(c);e=b.subscriptionCounter;b.subscriptionCounter+=1;c.id=e;c.handle=[a,e];q._debug("Added listener",c,"for channel",a,"having id \x3d",e);return c.handle}
var q=this,fa=h||"default",M=!1,A=new l.cometd.TransportRegistry,B,H="disconnected",ea=0,I=null,G=0,J=[],L=!1,F={},x=0,O=null,y=[],z={},S,P={},T=!1,R=!1,t={connectTimeout:0,maxConnections:2,backoffIncrement:1E3,maxBackoff:6E4,logLevel:"info",reverseIncomingExtensions:!0,maxNetworkDelay:1E4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,advice:{timeout:6E4,interval:0,reconnect:"retry"}};this._mixin=function(a,b,e){for(var c=b||{},d=2;d<arguments.length;++d){var g=arguments[d];if(!(void 0===
g||null===g))for(var k in g){var m=g[k],f=c[k];m!==b&&void 0!==m&&(c[k]=a&&"object"===typeof m&&null!==m?m instanceof Array?this._mixin(a,f instanceof Array?f:[],m):this._mixin(a,"object"===typeof f&&!(f instanceof Array)?f:{},m):m)}}return c};this._warn=function(){a("warn",arguments)};this._info=function(){"warn"!==t.logLevel&&a("info",arguments)};this._debug=function(){"debug"===t.logLevel&&a("debug",arguments)};this._isCrossDomain=function(a){return a&&a!==window.location.host};var V,Q;this.send=
v;this.receive=aa;V=function(a){q._debug("Received",a);for(var b=0;b<a.length;++b)aa(a[b])};Q=function(a,b,e,c){q._debug("handleFailure",a,b,e,c);for(e=0;e<b.length;++e){var d=b[e];switch(d.channel){case "/meta/handshake":E({successful:!1,failure:!0,channel:"/meta/handshake",request:d,xhr:a,advice:{reconnect:"retry",interval:x}});break;case "/meta/connect":c=a;R=!1;U({successful:!1,failure:!0,channel:"/meta/connect",request:d,xhr:c,advice:{reconnect:"retry",interval:x}});break;case "/meta/disconnect":W({successful:!1,
failure:!0,channel:"/meta/disconnect",request:d,xhr:a,advice:{reconnect:"none",interval:0}});break;case "/meta/subscribe":X({successful:!1,failure:!0,channel:"/meta/subscribe",request:d,xhr:a,advice:{reconnect:"none",interval:0}});break;case "/meta/unsubscribe":Y({successful:!1,failure:!0,channel:"/meta/unsubscribe",request:d,xhr:a,advice:{reconnect:"none",interval:0}});break;default:$({successful:!1,failure:!0,channel:d.channel,request:d,xhr:a,advice:{reconnect:"none",interval:0}})}}};this.registerTransport=
function(a,e,c){if(c=A.add(a,e,c))this._debug("Registered transport",a),b(e.registered)&&e.registered(a,this);return c};this.getTransportTypes=function(){return A.getTransportTypes()};this.unregisterTransport=function(a){var e=A.remove(a);null!==e&&(this._debug("Unregistered transport",a),b(e.unregistered)&&e.unregistered());return e};this.unregisterTransports=function(){A.clear()};this.findTransport=function(a){return A.find(a)};this.configure=function(a){q._debug("Configuring cometd object with",
a);f(a)&&(a={url:a});a||(a={});t=q._mixin(!1,t,a);if(!t.url)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";var b=/(^https?:\/\/)?(((\[[^\]]+\])|([^:\/\?#]+))(:(\d+))?)?([^\?#]*)(.*)?/.exec(t.url);a=b[8];var e=b[9];M=q._isCrossDomain(b[2]);t.appendMessageTypeToURL&&(void 0!==e&&0<e.length?(q._info("Appending message type to URI "+a+e+" is not supported, disabling 'appendMessageTypeToURL' configuration"),t.appendMessageTypeToURL=!1):(b=a.split("/"),e=b.length-
1,a.match(/\/$/)&&(e-=1),0<=b[e].indexOf(".")&&(q._info("Appending message type to URI "+a+" is not supported, disabling 'appendMessageTypeToURL' configuration"),t.appendMessageTypeToURL=!1)))};this.init=function(a,b){this.configure(a);this.handshake(b)};this.handshake=function(a){d("disconnected");T=!1;N(a)};this.disconnect=function(a,b){if(!g()){void 0===b&&"boolean"!==typeof a&&(b=a,a=!1);var e=this._mixin(!1,{},b,{channel:"/meta/disconnect"});d("disconnecting");r(!0===a,[e],!1,"disconnect")}};
this.startBatch=function(){++G};this.endBatch=function(){--G;if(0>G)throw"Calls to startBatch() and endBatch() are not paired";0===G&&(!g()&&!L)&&s()};this.batch=function(a,b){var e=ca(a,b);this.startBatch();try{e.method.call(e.scope),this.endBatch()}catch(c){throw this._debug("Exception during execution of batch",c),this.endBatch(),c;}};this.addListener=function(a,b,e){if(2>arguments.length)throw"Illegal arguments number: required 2, got "+arguments.length;if(!f(a))throw"Illegal argument type: channel must be a string";
return da(a,b,e,!0)};this.removeListener=function(a){if(!l.cometd.Utils.isArray(a))throw"Invalid argument: expected subscription, not "+a;var b=F[a[0]],e;if(0<b.length){e=a[1];a:{for(var c=0;c<b.length;){if(b[c].id===e){e=c;break a}c+=1}e=-1}-1!==e&&(b.splice(e,1),q._debug("Removed listener",a))}};this.clearListeners=function(){F={}};this.subscribe=function(a,e,c,d){if(2>arguments.length)throw"Illegal arguments number: required 2, got "+arguments.length;if(!f(a))throw"Illegal argument type: channel must be a string";
if(g())throw"Illegal state: already disconnected";b(e)&&(d=c,c=e,e=void 0);var k=!ba(a),m=da(a,e,c,!1);k&&(k=this._mixin(!1,{},d,{channel:"/meta/subscribe",subscription:a}),v(k));return m};this.unsubscribe=function(a,b){if(1>arguments.length)throw"Illegal arguments number: required 1, got "+arguments.length;if(g())throw"Illegal state: already disconnected";this.removeListener(a);var e=a[0];ba(e)||(e=this._mixin(!1,{},b,{channel:"/meta/unsubscribe",subscription:e}),v(e))};this.clearSubscriptions=function(){c()};
this.publish=function(a,e,c,d){if(1>arguments.length)throw"Illegal arguments number: required 1, got "+arguments.length;if(!f(a))throw"Illegal argument type: channel must be a string";if(g())throw"Illegal state: already disconnected";b(e)?(d=e,e=c={}):b(c)&&(d=c,c={});var k=this._mixin(!1,{},c,{channel:a,data:e,_callback:d});v(k)};this.getStatus=function(){return H};this.isDisconnected=g;this.setBackoffIncrement=function(a){t.backoffIncrement=a};this.getBackoffIncrement=function(){return t.backoffIncrement};
this.getBackoffPeriod=function(){return x};this.setLogLevel=function(a){t.logLevel=a};this.registerExtension=function(a,e){if(2>arguments.length)throw"Illegal arguments number: required 2, got "+arguments.length;if(!f(a))throw"Illegal argument type: extension name must be a string";for(var c=!1,d=0;d<y.length;++d)if(y[d].name===a){c=!0;break}if(c)return this._info("Could not register extension with name",a,"since another extension with the same name already exists"),!1;y.push({name:a,extension:e});
this._debug("Registered extension",a);b(e.registered)&&e.registered(a,this);return!0};this.unregisterExtension=function(a){if(!f(a))throw"Illegal argument type: extension name must be a string";for(var e=!1,c=0;c<y.length;++c){var d=y[c];if(d.name===a){y.splice(c,1);e=!0;this._debug("Unregistered extension",a);a=d.extension;b(a.unregistered)&&a.unregistered();break}}return e};this.getExtension=function(a){for(var b=0;b<y.length;++b){var e=y[b];if(e.name===a)return e.extension}return null};this.getName=
function(){return fa};this.getClientId=function(){return I};this.getURL=function(){return t.url};this.getTransport=function(){return B};this.getConfiguration=function(){return this._mixin(!0,{},t)};this.getAdvice=function(){return this._mixin(!0,{},z)};l.cometd.WebSocket=window.WebSocket;l.cometd.WebSocket||(l.cometd.WebSocket=window.MozWebSocket)};return l.cometd})},"dojox/cometd/AckExtension":function(){define(["./cometd"],function(l){return l.AckExtension=function(){var h,f=!1,b=-1;this.registered=
function(a,b){h=b;h._debug("AckExtension: executing registration callback",void 0)};this.unregistered=function(){h._debug("AckExtension: executing unregistration callback",void 0);h=null};this.incoming=function(a){var c=a.channel;if("/meta/handshake"==c)f=a.ext&&a.ext.ack,h._debug("AckExtension: server supports acks",f);else if(f&&"/meta/connect"==c&&a.successful&&(c=a.ext)&&"number"===typeof c.ack)b=c.ack,h._debug("AckExtension: server sent ack id",b);return a};this.outgoing=function(a){var c=a.channel;
"/meta/handshake"==c?(a.ext||(a.ext={}),a.ext.ack=h&&!1!==h.ackEnabled,b=-1):f&&"/meta/connect"==c&&(a.ext||(a.ext={}),a.ext.ack=b,h._debug("AckExtension: client sending ack id",b));return a}}})},"MW/Log":function(){define("MW/Log",["dojo/date/locale"],function(l){return function(){function h(b){g&&(e||!c||!c.log)&&g.apply(a,b)}function f(b){d[b]=function(){if(0!==m&&c&&c[b])if("assert"===b){if(!arguments[0])if(a.ScriptEngine){var e=Array.prototype.slice.call(arguments);e.shift();c[b](!1,e)}else c[b].apply(c,
arguments)}else if(a.ScriptEngine)if(-1!==b.indexOf("profile"))c[b]();else c[b](arguments[0]);else c[b].apply(c,arguments)}}function b(b,e){d[e]=function(){var d=Array.prototype.slice.call(arguments),g=l.format(new Date,{selector:"date",datePattern:"h:m:s.SSS"}),f=[e].concat(d),d=[g].concat(d);n.push(f);n.length>p&&n.shift();h(f);if(c&&(0<m?m>b:k.length+m<=b))if(c.firebug&&"error"!==e)c[e].apply(a,d);else if(c[e])c[e](d);else c.log(d)}}var a=this,c=a.console,d={},g,e,m=9,n=[],p=25,k=["error","warn",
"info","debug","log"],u="assert clear count dir dirxml exception group groupCollapsed groupEnd profile profileEnd table time timeEnd trace".split(" "),r;for(r=u.length;0<=(r-=1);)f(u[r]);for(r=k.length;0<=(r-=1);)b(r,k[r]);d.setLevel=function(a){m="number"===typeof a?a:9};d.setCallback=function(a,b,c){var d=n.length;g=a||null;e="boolean"===typeof b?b:!1;for(a=d-("number"===c?c:d);a<d;)h(n[a+=1])};return d}()})},"dojo/date/locale":function(){define("../_base/lang ../_base/array ../date ../cldr/supplemental ../i18n ../regexp ../string ../i18n!../cldr/nls/gregorian module".split(" "),
function(l,h,f,b,a,c,d,g,e){function m(a,e,c,g){return g.replace(/([a-z])\1*/ig,function(m){var f,n,h=m.charAt(0);m=m.length;var l=["abbr","wide","narrow"];switch(h){case "G":f=e[4>m?"eraAbbr":"eraNames"][0>a.getFullYear()?0:1];break;case "y":f=a.getFullYear();switch(m){case 1:break;case 2:if(!c.fullYear){f=String(f);f=f.substr(f.length-2);break}default:n=!0}break;case "Q":case "q":f=Math.ceil((a.getMonth()+1)/3);n=!0;break;case "M":case "L":f=a.getMonth();3>m?(f+=1,n=!0):(h=["months","L"==h?"standAlone":
"format",l[m-3]].join("-"),f=e[h][f]);break;case "w":f=k._getWeekOfYear(a,0);n=!0;break;case "d":f=a.getDate();n=!0;break;case "D":f=k._getDayOfYear(a);n=!0;break;case "e":case "c":if(f=a.getDay(),2>m){f=(f-b.getFirstDayOfWeek(c.locale)+8)%7;break}case "E":f=a.getDay();3>m?(f+=1,n=!0):(h=["days","c"==h?"standAlone":"format",l[m-3]].join("-"),f=e[h][f]);break;case "a":h=12>a.getHours()?"am":"pm";f=c[h]||e["dayPeriods-format-wide-"+h];break;case "h":case "H":case "K":case "k":n=a.getHours();switch(h){case "h":f=
n%12||12;break;case "H":f=n;break;case "K":f=n%12;break;case "k":f=n||24}n=!0;break;case "m":f=a.getMinutes();n=!0;break;case "s":f=a.getSeconds();n=!0;break;case "S":f=Math.round(a.getMilliseconds()*Math.pow(10,m-3));n=!0;break;case "v":case "z":if(f=k._getZone(a,!0,c))break;m=4;case "Z":h=k._getZone(a,!1,c);h=[0>=h?"+":"-",d.pad(Math.floor(Math.abs(h)/60),2),d.pad(Math.abs(h)%60,2)];4==m&&(h.splice(0,0,"GMT"),h.splice(3,0,":"));f=h.join("");break;default:throw Error("dojo.date.locale.format: invalid pattern char: "+
g);}n&&(f=d.pad(f,m));return f})}function n(a,b,e,c){var d=function(a){return a};b=b||d;e=e||d;c=c||d;var g=a.match(/(''|[^'])+/g),k="'"==a.charAt(0);h.forEach(g,function(a,c){a?(g[c]=(k?e:b)(a.replace(/''/g,"'")),k=!k):g[c]=""});return c(g.join(""))}function p(a,b,e,d){d=c.escapeString(d);e.strict||(d=d.replace(" a"," ?a"));return d.replace(/([a-z])\1*/ig,function(c){var d;d=c.charAt(0);var g=c.length,k="",f="";e.strict?(1<g&&(k="0{"+(g-1)+"}"),2<g&&(f="0{"+(g-2)+"}")):(k="0?",f="0{0,2}");switch(d){case "y":d=
"\\d{2,4}";break;case "M":case "L":d=2<g?"\\S+?":"1[0-2]|"+k+"[1-9]";break;case "D":d="[12][0-9][0-9]|3[0-5][0-9]|36[0-6]|"+k+"[1-9][0-9]|"+f+"[1-9]";break;case "d":d="3[01]|[12]\\d|"+k+"[1-9]";break;case "w":d="[1-4][0-9]|5[0-3]|"+k+"[1-9]";break;case "E":case "e":case "c":d=".+?";break;case "h":d="1[0-2]|"+k+"[1-9]";break;case "k":d="1[01]|"+k+"\\d";break;case "H":d="1\\d|2[0-3]|"+k+"\\d";break;case "K":d="1\\d|2[0-4]|"+k+"[1-9]";break;case "m":case "s":d="[0-5]\\d";break;case "S":d="\\d{"+g+"}";
break;case "a":g=e.am||b["dayPeriods-format-wide-am"];k=e.pm||b["dayPeriods-format-wide-pm"];d=g+"|"+k;e.strict||(g!=g.toLowerCase()&&(d+="|"+g.toLowerCase()),k!=k.toLowerCase()&&(d+="|"+k.toLowerCase()),-1!=d.indexOf(".")&&(d+="|"+d.replace(/\./g,"")));d=d.replace(/\./g,"\\.");break;default:d=".*"}a&&a.push(c);return"("+d+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var k={};l.setObject(e.id.replace(/\//g,"."),k);k._getZone=function(a,b,e){return b?f.getTimezoneName(a):a.getTimezoneOffset()};k.format=
function(b,e){e=e||{};var c=a.normalizeLocale(e.locale),d=e.formatLength||"short",c=k._getGregorianBundle(c),g=[],f=l.hitch(this,m,b,c,e);if("year"==e.selector)return n(c["dateFormatItem-yyyy"]||"yyyy",f);var h;"date"!=e.selector&&(h=e.timePattern||c["timeFormat-"+d])&&g.push(n(h,f));"time"!=e.selector&&(h=e.datePattern||c["dateFormat-"+d])&&g.push(n(h,f));return 1==g.length?g[0]:c["dateTimeFormat-"+d].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(a,b){return g[b]})};k.regexp=function(a){return k._parseInfo(a).regexp};
k._parseInfo=function(b){b=b||{};var e=a.normalizeLocale(b.locale),e=k._getGregorianBundle(e),c=b.formatLength||"short",d=b.datePattern||e["dateFormat-"+c],g=b.timePattern||e["timeFormat-"+c],c="date"==b.selector?d:"time"==b.selector?g:e["dateTimeFormat-"+c].replace(/\{(\d+)\}/g,function(a,b){return[g,d][b]}),f=[];return{regexp:n(c,l.hitch(this,p,f,e,b)),tokens:f,bundle:e}};k.parse=function(a,b){var e=/[\u200E\u200F\u202A\u202E]/g,c=k._parseInfo(b),d=c.tokens,g=c.bundle,e=RegExp("^"+c.regexp.replace(e,
"")+"$",c.strict?"":"i").exec(a&&a.replace(e,""));if(!e)return null;var m=["abbr","wide","narrow"],n=[1970,0,1,0,0,0,0],l="",e=h.every(e,function(a,e){if(!e)return!0;var c=d[e-1],k=c.length,c=c.charAt(0);switch(c){case "y":if(2!=k&&b.strict)n[0]=a;else if(100>a)a=Number(a),c=""+(new Date).getFullYear(),k=100*c.substring(0,2),c=Math.min(Number(c.substring(2,4))+20,99),n[0]=a<c?k+a:k-100+a;else{if(b.strict)return!1;n[0]=a}break;case "M":case "L":if(2<k){if(k=g["months-"+("L"==c?"standAlone":"format")+
"-"+m[k-3]].concat(),b.strict||(a=a.replace(".","").toLowerCase(),k=h.map(k,function(a){return a.replace(".","").toLowerCase()})),a=h.indexOf(k,a),-1==a)return!1}else a--;n[1]=a;break;case "E":case "e":case "c":k=g["days-"+("c"==c?"standAlone":"format")+"-"+m[k-3]].concat();b.strict||(a=a.toLowerCase(),k=h.map(k,function(a){return a.toLowerCase()}));a=h.indexOf(k,a);if(-1==a)return!1;break;case "D":n[1]=0;case "d":n[2]=a;break;case "a":k=b.am||g["dayPeriods-format-wide-am"];c=b.pm||g["dayPeriods-format-wide-pm"];
if(!b.strict){var f=/\./g;a=a.replace(f,"").toLowerCase();k=k.replace(f,"").toLowerCase();c=c.replace(f,"").toLowerCase()}if(b.strict&&a!=k&&a!=c)return!1;l=a==c?"p":a==k?"a":"";break;case "K":24==a&&(a=0);case "h":case "H":case "k":if(23<a)return!1;n[3]=a;break;case "m":n[4]=a;break;case "s":n[5]=a;break;case "S":n[6]=a}return!0}),c=+n[3];"p"===l&&12>c?n[3]=c+12:"a"===l&&12==c&&(n[3]=0);c=new Date(n[0],n[1],n[2],n[3],n[4],n[5],n[6]);b.strict&&c.setFullYear(n[0]);var p=d.join(""),u=-1!=p.indexOf("d"),
p=-1!=p.indexOf("M");if(!e||p&&c.getMonth()>n[1]||u&&c.getDate()>n[2])return null;if(p&&c.getMonth()<n[1]||u&&c.getDate()<n[2])c=f.add(c,"hour",1);return c};var u=[];k.addCustomFormats=function(a,b){u.push({pkg:a,name:b})};k._getGregorianBundle=function(b){var e={};h.forEach(u,function(c){c=a.getLocalization(c.pkg,c.name,b);e=l.mixin(e,c)},this);return e};k.addCustomFormats(e.id.replace(/\/date\/locale$/,".cldr"),"gregorian");k.getNames=function(a,b,e,c){var d;c=k._getGregorianBundle(c);a=[a,e,b];
"standAlone"==e&&(e=a.join("-"),d=c[e],1==d[0]&&(d=void 0));a[1]="format";return(d||c[a.join("-")]).concat()};k.isWeekend=function(a,e){var c=b.getWeekend(e),d=(a||new Date).getDay();c.end<c.start&&(c.end+=7,d<c.start&&(d+=7));return d>=c.start&&d<=c.end};k._getDayOfYear=function(a){return f.difference(new Date(a.getFullYear(),0,1,a.getHours()),a)+1};k._getWeekOfYear=function(a,b){1==arguments.length&&(b=0);var e=(new Date(a.getFullYear(),0,1)).getDay(),c=Math.floor((k._getDayOfYear(a)+(e-b+7)%7-
1)/7);e==b&&c++;return c};return k})},"dojo/date":function(){define(["./has","./_base/lang"],function(l,h){var f={getDaysInMonth:function(b){var a=b.getMonth();return 1==a&&f.isLeapYear(b)?29:[31,28,31,30,31,30,31,31,30,31,30,31][a]},isLeapYear:function(b){b=b.getFullYear();return!(b%400)||!(b%4)&&!!(b%100)},getTimezoneName:function(b){var a=b.toString(),c="",d=a.indexOf("(");if(-1<d)c=a.substring(++d,a.indexOf(")"));else if(d=/([A-Z\/]+) \d{4}$/,a=a.match(d))c=a[1];else if(a=b.toLocaleString(),d=
/ ([A-Z\/]+)$/,a=a.match(d))c=a[1];return"AM"==c||"PM"==c?"":c},compare:function(b,a,c){b=new Date(+b);a=new Date(+(a||new Date));"date"==c?(b.setHours(0,0,0,0),a.setHours(0,0,0,0)):"time"==c&&(b.setFullYear(0,0,0),a.setFullYear(0,0,0));return b>a?1:b<a?-1:0},add:function(b,a,c){var d=new Date(+b),g=!1,e="Date";switch(a){case "day":break;case "weekday":var f;(a=c%5)?f=parseInt(c/5):(a=0<c?5:-5,f=0<c?(c-5)/5:(c+5)/5);var n=b.getDay(),h=0;6==n&&0<c?h=1:0==n&&0>c&&(h=-1);n+=a;if(0==n||6==n)h=0<c?2:-2;
c=7*f+a+h;break;case "year":e="FullYear";g=!0;break;case "week":c*=7;break;case "quarter":c*=3;case "month":g=!0;e="Month";break;default:e="UTC"+a.charAt(0).toUpperCase()+a.substring(1)+"s"}if(e)d["set"+e](d["get"+e]()+c);g&&d.getDate()<b.getDate()&&d.setDate(0);return d},difference:function(b,a,c){a=a||new Date;c=c||"day";var d=a.getFullYear()-b.getFullYear(),g=1;switch(c){case "quarter":b=b.getMonth();a=a.getMonth();b=Math.floor(b/3)+1;a=Math.floor(a/3)+1;g=a+4*d-b;break;case "weekday":d=Math.round(f.difference(b,
a,"day"));c=parseInt(f.difference(b,a,"week"));g=d%7;if(0==g)d=5*c;else{var e=0,m=b.getDay();a=a.getDay();c=parseInt(d/7);g=d%7;b=new Date(b);b.setDate(b.getDate()+7*c);b=b.getDay();if(0<d)switch(!0){case 6==m:e=-1;break;case 0==m:e=0;break;case 6==a:e=-1;break;case 0==a:e=-2;break;case 5<b+g:e=-2}else if(0>d)switch(!0){case 6==m:e=0;break;case 0==m:e=1;break;case 6==a:e=2;break;case 0==a:e=1;break;case 0>b+g:e=2}d=d+e-2*c}g=d;break;case "year":g=d;break;case "month":g=a.getMonth()-b.getMonth()+12*
d;break;case "week":g=parseInt(f.difference(b,a,"day")/7);break;case "day":g/=24;case "hour":g/=60;case "minute":g/=60;case "second":g/=1E3;case "millisecond":g*=a.getTime()-b.getTime()}return Math.round(g)}};h.mixin(h.getObject("dojo.date",!0),f);return f})},"dojo/cldr/supplemental":function(){define(["../_base/lang","../i18n"],function(l,h){var f={};l.setObject("dojo.cldr.supplemental",f);f.getFirstDayOfWeek=function(b){b={bd:5,mv:5,ae:6,af:6,bh:6,dj:6,dz:6,eg:6,iq:6,ir:6,jo:6,kw:6,ly:6,ma:6,om:6,
qa:6,sa:6,sd:6,sy:6,ye:6,ag:0,ar:0,as:0,au:0,br:0,bs:0,bt:0,bw:0,by:0,bz:0,ca:0,cn:0,co:0,dm:0,"do":0,et:0,gt:0,gu:0,hk:0,hn:0,id:0,ie:0,il:0,"in":0,jm:0,jp:0,ke:0,kh:0,kr:0,la:0,mh:0,mm:0,mo:0,mt:0,mx:0,mz:0,ni:0,np:0,nz:0,pa:0,pe:0,ph:0,pk:0,pr:0,py:0,sg:0,sv:0,th:0,tn:0,tt:0,tw:0,um:0,us:0,ve:0,vi:0,ws:0,za:0,zw:0}[f._region(b)];return void 0===b?1:b};f._region=function(b){b=h.normalizeLocale(b);b=b.split("-");var a=b[1];a?4==a.length&&(a=b[2]):a={aa:"et",ab:"ge",af:"za",ak:"gh",am:"et",ar:"eg",
as:"in",av:"ru",ay:"bo",az:"az",ba:"ru",be:"by",bg:"bg",bi:"vu",bm:"ml",bn:"bd",bo:"cn",br:"fr",bs:"ba",ca:"es",ce:"ru",ch:"gu",co:"fr",cr:"ca",cs:"cz",cv:"ru",cy:"gb",da:"dk",de:"de",dv:"mv",dz:"bt",ee:"gh",el:"gr",en:"us",es:"es",et:"ee",eu:"es",fa:"ir",ff:"sn",fi:"fi",fj:"fj",fo:"fo",fr:"fr",fy:"nl",ga:"ie",gd:"gb",gl:"es",gn:"py",gu:"in",gv:"gb",ha:"ng",he:"il",hi:"in",ho:"pg",hr:"hr",ht:"ht",hu:"hu",hy:"am",ia:"fr",id:"id",ig:"ng",ii:"cn",ik:"us","in":"id",is:"is",it:"it",iu:"ca",iw:"il",ja:"jp",
ji:"ua",jv:"id",jw:"id",ka:"ge",kg:"cd",ki:"ke",kj:"na",kk:"kz",kl:"gl",km:"kh",kn:"in",ko:"kr",ks:"in",ku:"tr",kv:"ru",kw:"gb",ky:"kg",la:"va",lb:"lu",lg:"ug",li:"nl",ln:"cd",lo:"la",lt:"lt",lu:"cd",lv:"lv",mg:"mg",mh:"mh",mi:"nz",mk:"mk",ml:"in",mn:"mn",mo:"ro",mr:"in",ms:"my",mt:"mt",my:"mm",na:"nr",nb:"no",nd:"zw",ne:"np",ng:"na",nl:"nl",nn:"no",no:"no",nr:"za",nv:"us",ny:"mw",oc:"fr",om:"et",or:"in",os:"ge",pa:"in",pl:"pl",ps:"af",pt:"br",qu:"pe",rm:"ch",rn:"bi",ro:"ro",ru:"ru",rw:"rw",sa:"in",
sd:"in",se:"no",sg:"cf",si:"lk",sk:"sk",sl:"si",sm:"ws",sn:"zw",so:"so",sq:"al",sr:"rs",ss:"za",st:"za",su:"id",sv:"se",sw:"tz",ta:"in",te:"in",tg:"tj",th:"th",ti:"et",tk:"tm",tl:"ph",tn:"za",to:"to",tr:"tr",ts:"za",tt:"ru",ty:"pf",ug:"cn",uk:"ua",ur:"pk",uz:"uz",ve:"za",vi:"vn",wa:"be",wo:"sn",xh:"za",yi:"il",yo:"ng",za:"cn",zh:"cn",zu:"za",ace:"id",ady:"ru",agq:"cm",alt:"ru",amo:"ng",asa:"tz",ast:"es",awa:"in",bal:"pk",ban:"id",bas:"cm",bax:"cm",bbc:"id",bem:"zm",bez:"tz",bfq:"in",bft:"pk",bfy:"in",
bhb:"in",bho:"in",bik:"ph",bin:"ng",bjj:"in",bku:"ph",bqv:"ci",bra:"in",brx:"in",bss:"cm",btv:"pk",bua:"ru",buc:"yt",bug:"id",bya:"id",byn:"er",cch:"ng",ccp:"in",ceb:"ph",cgg:"ug",chk:"fm",chm:"ru",chp:"ca",chr:"us",cja:"kh",cjm:"vn",ckb:"iq",crk:"ca",csb:"pl",dar:"ru",dav:"ke",den:"ca",dgr:"ca",dje:"ne",doi:"in",dsb:"de",dua:"cm",dyo:"sn",dyu:"bf",ebu:"ke",efi:"ng",ewo:"cm",fan:"gq",fil:"ph",fon:"bj",fur:"it",gaa:"gh",gag:"md",gbm:"in",gcr:"gf",gez:"et",gil:"ki",gon:"in",gor:"id",grt:"in",gsw:"ch",
guz:"ke",gwi:"ca",haw:"us",hil:"ph",hne:"in",hnn:"ph",hoc:"in",hoj:"in",ibb:"ng",ilo:"ph",inh:"ru",jgo:"cm",jmc:"tz",kaa:"uz",kab:"dz",kaj:"ng",kam:"ke",kbd:"ru",kcg:"ng",kde:"tz",kdt:"th",kea:"cv",ken:"cm",kfo:"ci",kfr:"in",kha:"in",khb:"cn",khq:"ml",kht:"in",kkj:"cm",kln:"ke",kmb:"ao",koi:"ru",kok:"in",kos:"fm",kpe:"lr",krc:"ru",kri:"sl",krl:"ru",kru:"in",ksb:"tz",ksf:"cm",ksh:"de",kum:"ru",lag:"tz",lah:"pk",lbe:"ru",lcp:"cn",lep:"in",lez:"ru",lif:"np",lis:"cn",lki:"ir",lmn:"in",lol:"cd",lua:"cd",
luo:"ke",luy:"ke",lwl:"th",mad:"id",mag:"in",mai:"in",mak:"id",man:"gn",mas:"ke",mdf:"ru",mdh:"ph",mdr:"id",men:"sl",mer:"ke",mfe:"mu",mgh:"mz",mgo:"cm",min:"id",mni:"in",mnk:"gm",mnw:"mm",mos:"bf",mua:"cm",mwr:"in",myv:"ru",nap:"it",naq:"na",nds:"de","new":"np",niu:"nu",nmg:"cm",nnh:"cm",nod:"th",nso:"za",nus:"sd",nym:"tz",nyn:"ug",pag:"ph",pam:"ph",pap:"bq",pau:"pw",pon:"fm",prd:"ir",raj:"in",rcf:"re",rej:"id",rjs:"np",rkt:"in",rof:"tz",rwk:"tz",saf:"gh",sah:"ru",saq:"ke",sas:"id",sat:"in",saz:"in",
sbp:"tz",scn:"it",sco:"gb",sdh:"ir",seh:"mz",ses:"ml",shi:"ma",shn:"mm",sid:"et",sma:"se",smj:"se",smn:"fi",sms:"fi",snk:"ml",srn:"sr",srr:"sn",ssy:"er",suk:"tz",sus:"gn",swb:"yt",swc:"cd",syl:"bd",syr:"sy",tbw:"ph",tcy:"in",tdd:"cn",tem:"sl",teo:"ug",tet:"tl",tig:"er",tiv:"ng",tkl:"tk",tmh:"ne",tpi:"pg",trv:"tw",tsg:"ph",tts:"th",tum:"mw",tvl:"tv",twq:"ne",tyv:"ru",tzm:"ma",udm:"ru",uli:"fm",umb:"ao",unr:"in",unx:"in",vai:"lr",vun:"tz",wae:"ch",wal:"et",war:"ph",xog:"ug",xsr:"np",yao:"mz",yap:"fm",
yav:"cm",zza:"tr"}[b[0]];return a};f.getWeekend=function(b){var a=f._region(b);b={"in":0,af:4,dz:4,ir:4,om:4,sa:4,ye:4,ae:5,bh:5,eg:5,il:5,iq:5,jo:5,kw:5,ly:5,ma:5,qa:5,sd:5,sy:5,tn:5}[a];a={af:5,dz:5,ir:5,om:5,sa:5,ye:5,ae:6,bh:5,eg:6,il:6,iq:6,jo:6,kw:6,ly:6,ma:6,qa:6,sd:6,sy:6,tn:6}[a];void 0===b&&(b=6);void 0===a&&(a=0);return{start:b,end:a}};return f})},"dojo/regexp":function(){define(["./_base/kernel","./_base/lang"],function(l,h){var f={};h.setObject("dojo.regexp",f);f.escapeString=function(b,
a){return b.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,function(b){return a&&-1!=a.indexOf(b)?b:"\\"+b})};f.buildGroupRE=function(b,a,c){if(!(b instanceof Array))return a(b);for(var d=[],g=0;g<b.length;g++)d.push(a(b[g]));return f.group(d.join("|"),c)};f.group=function(b,a){return"("+(a?"?:":"")+b+")"};return f})},"dojo/string":function(){define(["./_base/kernel","./_base/lang"],function(l,h){var f=/[&<>'"\/]/g,b={"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;","/":"\x26#x2F;"},
a={};h.setObject("dojo.string",a);a.escape=function(a){return!a?"":a.replace(f,function(a){return b[a]})};a.rep=function(a,b){if(0>=b||!a)return"";for(var g=[];;){b&1&&g.push(a);if(!(b>>=1))break;a+=a}return g.join("")};a.pad=function(b,d,g,e){g||(g="0");b=String(b);d=a.rep(g,Math.ceil((d-b.length)/g.length));return e?b+d:d+b};a.substitute=function(a,b,g,e){e=e||l.global;g=g?h.hitch(e,g):function(a){return a};return a.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,function(a,c,f){a=h.getObject(c,
!1,b);f&&(a=h.getObject(f,!1,e).call(e,a,c));return g(a,c).toString()})};a.trim=String.prototype.trim?h.trim:function(a){a=a.replace(/^\s+/,"");for(var b=a.length-1;0<=b;b--)if(/\S/.test(a.charAt(b))){a=a.substring(0,b+1);break}return a};return a})},"dojo/cldr/nls/gregorian":function(){define({root:{"dateFormatItem-Ehm":"E h:mm a","days-standAlone-short":"Sun Mon Tue Wed Thu Fri Sat".split(" "),"months-format-narrow":"1 2 3 4 5 6 7 8 9 10 11 12".split(" "),"field-second-relative+0":"now","quarters-standAlone-narrow":["1",
"2","3","4"],"field-weekday":"Day of the Week","dateFormatItem-yQQQ":"y QQQ","dateFormatItem-yMEd":"y-MM-dd, E","field-wed-relative+0":"this Wednesday","field-wed-relative+1":"next Wednesday","dateFormatItem-GyMMMEd":"G y MMM d, E","dateFormatItem-MMMEd":"MMM d, E",eraNarrow:["BCE","CE"],"field-tue-relative+-1":"last Tuesday","days-format-short":"Sun Mon Tue Wed Thu Fri Sat".split(" "),"dateTimeFormats-appendItem-Day-Of-Week":"{0} {1}","dateFormat-long":"y MMMM d","field-fri-relative+-1":"last Friday",
"field-wed-relative+-1":"last Wednesday","months-format-wide":"M01 M02 M03 M04 M05 M06 M07 M08 M09 M10 M11 M12".split(" "),"dateTimeFormat-medium":"{1} {0}","dayPeriods-format-wide-pm":"PM","dateFormat-full":"y MMMM d, EEEE","field-thu-relative+-1":"last Thursday","dateFormatItem-Md":"MM-dd","dayPeriods-format-abbr-am":"AM","dateTimeFormats-appendItem-Second":"{0} ({2}: {1})","dayPeriods-format-wide-noon":"noon","dateFormatItem-yMd":"y-MM-dd","field-era":"Era","dateFormatItem-yM":"y-MM","months-standAlone-wide":"M01 M02 M03 M04 M05 M06 M07 M08 M09 M10 M11 M12".split(" "),
"timeFormat-short":"HH:mm","quarters-format-wide":["Q1","Q2","Q3","Q4"],"dateFormatItem-yQQQQ":"y QQQQ","timeFormat-long":"HH:mm:ss z","field-year":"Year","dateFormatItem-yMMM":"y MMM","dateTimeFormats-appendItem-Era":"{1} {0}","field-hour":"Hour","months-format-abbr":"M01 M02 M03 M04 M05 M06 M07 M08 M09 M10 M11 M12".split(" "),"field-sat-relative+0":"this Saturday","field-sat-relative+1":"next Saturday","timeFormat-full":"HH:mm:ss zzzz","dateTimeFormats-appendItem-Week":"{0} ({2}: {1})","field-day-relative+0":"today",
"field-thu-relative+0":"this Thursday","field-day-relative+1":"tomorrow","field-thu-relative+1":"next Thursday","dateFormatItem-GyMMMd":"G y MMM d","dateFormatItem-H":"HH","months-standAlone-abbr":"M01 M02 M03 M04 M05 M06 M07 M08 M09 M10 M11 M12".split(" "),"quarters-format-abbr":["Q1","Q2","Q3","Q4"],"quarters-standAlone-wide":["Q1","Q2","Q3","Q4"],"dateFormatItem-Gy":"G y","dateFormatItem-M":"L","days-standAlone-wide":"Sun Mon Tue Wed Thu Fri Sat".split(" "),"dayPeriods-format-abbr-noon":"noon",
"timeFormat-medium":"HH:mm:ss","field-sun-relative+0":"this Sunday","dateFormatItem-Hm":"HH:mm","field-sun-relative+1":"next Sunday","quarters-standAlone-abbr":["Q1","Q2","Q3","Q4"],eraAbbr:["BCE","CE"],"field-minute":"Minute","field-dayperiod":"Dayperiod","days-standAlone-abbr":"Sun Mon Tue Wed Thu Fri Sat".split(" "),"dateFormatItem-d":"d","dateFormatItem-ms":"mm:ss","quarters-format-narrow":["1","2","3","4"],"field-day-relative+-1":"yesterday","dateTimeFormat-long":"{1} {0}","dayPeriods-format-narrow-am":"a",
"dateFormatItem-h":"h a","dateFormatItem-MMMd":"MMM d","dateFormatItem-MEd":"MM-dd, E","dateTimeFormat-full":"{1} {0}","field-fri-relative+0":"this Friday","field-fri-relative+1":"next Friday","field-day":"Day","days-format-wide":"Sun Mon Tue Wed Thu Fri Sat".split(" "),"field-zone":"Zone","months-standAlone-narrow":"1 2 3 4 5 6 7 8 9 10 11 12".split(" "),"dateFormatItem-y":"y","dateTimeFormats-appendItem-Day":"{0} ({2}: {1})","field-year-relative+-1":"last year","field-month-relative+-1":"last month",
"dateTimeFormats-appendItem-Year":"{1} {0}","dateFormatItem-hm":"h:mm a","dateTimeFormats-appendItem-Hour":"{0} ({2}: {1})","dayPeriods-format-abbr-pm":"PM","days-format-abbr":"Sun Mon Tue Wed Thu Fri Sat".split(" "),eraNames:["BCE","CE"],"dateFormatItem-yMMMd":"y MMM d","days-format-narrow":"SMTWTFS".split(""),"field-month":"Month","days-standAlone-narrow":"SMTWTFS".split(""),"dateFormatItem-MMM":"LLL","field-tue-relative+0":"this Tuesday","dateTimeFormats-appendItem-Quarter":"{0} ({2}: {1})","field-tue-relative+1":"next Tuesday",
"dayPeriods-format-wide-am":"AM","dateTimeFormats-appendItem-Month":"{0} ({2}: {1})","dateTimeFormats-appendItem-Minute":"{0} ({2}: {1})","dateFormatItem-EHm":"E HH:mm","field-mon-relative+0":"this Monday","field-mon-relative+1":"next Monday","dateFormat-short":"y-MM-dd","dateFormatItem-EHms":"E HH:mm:ss","dateFormatItem-Ehms":"E h:mm:ss a","dayPeriods-format-narrow-noon":"n","field-second":"Second","field-sat-relative+-1":"last Saturday","dateFormatItem-yMMMEd":"y MMM d, E","field-sun-relative+-1":"last Sunday",
"field-month-relative+0":"this month","field-month-relative+1":"next month","dateTimeFormats-appendItem-Timezone":"{0} {1}","dateFormatItem-Ed":"d, E","field-week":"Week","dateFormat-medium":"y MMM d","field-week-relative+-1":"last week","field-year-relative+0":"this year","field-year-relative+1":"next year","dayPeriods-format-narrow-pm":"p","dateTimeFormat-short":"{1} {0}","dateFormatItem-Hms":"HH:mm:ss","dateFormatItem-hms":"h:mm:ss a","dateFormatItem-GyMMM":"G y MMM","field-mon-relative+-1":"last Monday",
"field-week-relative+0":"this week","field-week-relative+1":"next week"},ar:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,"en-au":!0,"en-ca":!0,"en-gb":!0,es:!0,fi:!0,fr:!0,"fr-ch":!0,he:!0,hu:!0,it:!0,ja:!0,ko:!0,nb:!0,nl:!0,pl:!0,pt:!0,"pt-pt":!0,ro:!0,ru:!0,sk:!0,sl:!0,sv:!0,th:!0,tr:!0,zh:!0,"zh-hant":!0,"zh-hk":!0,"zh-tw":!0})},"MW/remote/iframeproxy/IframeProxyClient":function(){define("dojo/_base/connect dojo/_base/declare dojo/_base/Deferred dojo/_base/json dojo/_base/lang dojo/aspect dojo/dom-construct require MW/Log ./CheckUrlService".split(" "),
function(l,h,f,b,a,c,d,g,e,m){var n=this,p=h([],{IFRAME_TIMEOUT:2E4,LATEST_VERSION:"1.4",REMOTE_PROXY:"/remote/proxy/",constructor:function(a){this.iframeId=a||"remoteProducer";this._messageId=0;this._loaded=!1;this._pendingQueue=[];this._transactions={};this._uploadTargetCallbacks={};this._loadTimeoutHandle=this._checkUrl=null;this._errorRate=0},setRemotePageHost:function(a,b,e,c,d){a=this._combineUriPaths(a||"","/");b=b||"";d=d||this.LATEST_VERSION;c=c||"";this.computeToken=e;a===this._host&&b===
this._key&&c===this._proxyUrl&&d===this._version||(this._errorLoading=this._loaded=!1,this._host=a,this._key=b,this._version=d,this._proxyUrl=c,a=this._calculateUrls(a,b,d,c),this._createIframe(a))},_calculateUrls:function(a,b,e,c){var d=this.REMOTE_PROXY+e+"/iframeProxyRelease.html";e=this.REMOTE_PROXY+e+"/CheckJsFile.js";c&&(d=c);d=this._combineUriPaths(a,d).split("?")[0];d+=b?"?routingkey\x3d"+b:"";e=this._combineUriPaths(a,e);e=b?e+("?routingkey\x3d"+b):e+("?time\x3d"+(new Date).getTime());return{fastFailUrl:e,
iFrameUrl:d}},_createIframe:function(a){var b=a.fastFailUrl,c=this;this._url=a.iFrameUrl;this.remoteIframe&&d.destroy(this.remoteIframe);e.info("Creating iframe ["+this.iframeId+"] for "+this._url+" at "+new Date);this.remoteIframe=d.create("iframe",{id:this.iframeId,src:this._url,width:0,height:0,style:"visibility: hidden; display: none;"});a=function(){c._loaded||("1.0"===c._version?c._handleLoadTimeout():"1.1"===c._version?(clearTimeout(c._loadTimeoutHandle),e.info("Unable to load proxy version "+
c._version+", trying 1.0."),c.setRemotePageHost(c._host,c._key,c.computeToken,c._proxyUrl,"1.0")):"1.2"===c._version?(clearTimeout(c._loadTimeoutHandle),e.info("Unable to load proxy version "+c._version+", trying 1.1."),c.setRemotePageHost(c._host,c._key,c.computeToken,c._proxyUrl,"1.1")):"1.3"===c._version?(clearTimeout(c._loadTimeoutHandle),e.info("Unable to load proxy version "+c._version+", trying 1.2."),c.setRemotePageHost(c._host,c._key,c.computeToken,c._proxyUrl,"1.2")):"1.4"===c._version?
(clearTimeout(c._loadTimeoutHandle),e.info("Unable to load proxy version "+c._version+", trying 1.3."),c.setRemotePageHost(c._host,c._key,c.computeToken,c._proxyUrl,"1.3")):(clearTimeout(c._loadTimeoutHandle),e.info("Unable to load proxy version "+c._version+", trying 1.0."),c.setRemotePageHost(c._host,c._key,c.computeToken,c._proxyUrl,"1.0")))};this._checkUrl=(new m(b)).then(function(){},a);this._loadTimeoutHandle=setTimeout(a,this.IFRAME_TIMEOUT);document.body.appendChild(this.remoteIframe);this._messageConnection||
(this._messageConnection=l.connect(n,"message",this,this._handleMessage))},createUploadIframeTarget:function(b,e,c){this._uploadTargetCallbacks[b]=a.hitch(c||this,e);this._postMessage("createUploadIframe;"+b)},cancelUpload:function(a){this._postMessage("cancelUpload;"+a)},getUploadIframeProxyUrlPath:function(){return this.REMOTE_PROXY+this._version+"/uploadIframeProxy.html"},sendMessage:function(a,c,d){var g=this,m;this.computeToken&&(d=d||{},d.headers=d.headers||{},d.headers.computeToken=this.computeToken);
m=this._getNewMessageId();c="sendMessage;"+m+";"+c+";"+(d?b.toJson(d):"{}");c+=";"+a;a={deferred:new f(function(){"1.0"===g._version?e.warn("Cancelling is not supported by the 1.0 remote proxy."):g._postMessage("abort;"+m)}),id:m};this._errorLoading?a.deferred.reject("The iFrame did not load properly: "+this._url):(this._transactions[m]=a,this._postMessage(c));return a.deferred},setLatency:function(a){this._latency=a},setErrorRate:function(a){this._errorRate=a},_postMessage:function(a){this._loaded?
this._postMessageNow(a):this._pendingQueue.push(a)},_handleMessage:function(a){var b,e;if(a.source===this.remoteIframe.contentWindow){e=a.data.indexOf(";");b=a.data.substring(0,e);if(!b)throw Error("Client unable to parse message, no action specified: "+a.data);switch(b){case "ready":this._cleanupFailureChecks();this._loaded=!0;this._flushPending();break;case "sendMessageResponse":this._sendMessageResponse(a,e);break;case "uploadIframeMessage":b=a.data.indexOf(";",e+1);e=a.data.substring(e+1,b);a=
a.data.substring(b+1,a.data.length);this._uploadTargetCallbacks[e](a);break;case "websocketOpened":this.onWebsocketOpen();break;case "websocketClosed":a=a.data.substring(e+1,a.data.length);a=JSON.parse(a);this.onWebsocketClose(a);break;case "websocketMsg":a=a.data.substring(e+1,a.data.length);a=JSON.parse(a);this.onWebsocketMsg(a);break;case "websocketError":this.onWebsocketError();break;default:throw Error("Unknown action: "+b+", data: "+a.data);}}},_sendMessageResponse:function(a,e){var c,d,g=a.data.indexOf(";",
e+1);c=a.data.indexOf(";",g+1);var f=a.data.substring(e+1,g),m=a.data.substring(g+1,c),g=a.data.substring(c+1,a.data.length);if(!f||!m)throw Error("Invalid message from remote iframe: "+a.data);c=this._transactions[f];if(!c)throw Error("Unknown transaction id: "+f+", from remote iframe: "+a.data);delete this._transactions[f];if(!c.deferred.isCanceled())if("success"===m){try{d=g&&b.fromJson(g)}catch(n){d=g}d=""===d?{}:d;c.deferred.resolve(d)}else"fault"===m&&g&&(d=g.split(";"),f=d.length-1,1<=f&&(g.statusCode=
d[f])),this.onError(g),c.deferred.reject(g)},_cleanupFailureChecks:function(){this._checkUrl&&!this._checkUrl.isFulfilled&&this._checkUrl.cancel("iFrame loaded...cancel URL check",!1);this._loadTimeoutHandle&&clearTimeout(this._loadTimeoutHandle);this._checkUrl=this._loadTimeoutHandle=null},_handleLoadTimeout:function(){var a,b;this._cleanupFailureChecks();if(!this._loaded)for(b in a={code:"IframeLoadTimeout",description:"Iframe proxy loading failed due to an HTTP error",message:""},this.onError(a),
this._errorLoading=!0,a=this._transactions,this._transactions={},a)a.hasOwnProperty(b)&&a[b].deferred.reject("Timeout while loading the iFrame "+this._url+" at "+new Date)},_postMessageNow:function(a){function b(){if(0<c._errorRate&&Math.random()<c._errorRate&&0===a.indexOf("sendMessage;")){if(d=a.split(";",2)[1],g=c._transactions[d])delete c._transactions[d],e.error("Generating simulated error. Request was: ",a),c.onError("403 Forbidden;403"),g.deferred.reject("403 Forbidden;403")}else c.remoteIframe.contentWindow.postMessage(a,
c._url)}var c=this,d,g;this._latency?setTimeout(b,this._latency):b()},_flushPending:function(){this._pendingQueue.forEach(this._postMessageNow,this);this._pendingQueue=[]},_getNewMessageId:function(){this._messageId+=1;return this._messageId.toString()},onError:function(){},onWebsocketOpen:function(){},onWebsocketMsg:function(){},onWebsocketClose:function(){},onWebsocketError:function(){},_combineUriPaths:function(){return Array.prototype.slice.call(arguments).reduce(function(a,b){if(0===a.length)return b;
0<b.length&&("/"===b[0]&&a.lastIndexOf("/")===a.length-1?b=b.substring(1):"/"!==b[0]&&a.lastIndexOf("/")!==a.length-1&&(a+="/"));return a+b})}});p.WebSocket=h([],{constructor:function(a){var b=this;this.proxyClient=p.WebSocket.proxyClient;this.proxyClient.computeToken&&0<=a.indexOf("?")&&(a=a+"\x26computeToken\x3d"+this.proxyClient.computeToken);this.proxyClient._postMessage("connectWebsocket;"+a);c.after(this.proxyClient,"onWebsocketOpen",function(){b.onopen.apply(b,arguments)},!0);c.after(this.proxyClient,
"onWebsocketMsg",function(){b.onmessage.apply(b,arguments)},!0);c.after(this.proxyClient,"onWebsocketClose",function(){b.onclose.apply(b,arguments)},!0);c.after(this.proxyClient,"onWebsocketError",function(){b.onerror.apply(b,arguments)},!0)},onopen:function(){},onmessage:function(){},onclose:function(){},onerror:function(){},send:function(a){this.proxyClient._postMessage("websocketSend;"+a)},close:function(){this.proxyClient._postMessage("closeWebsocket;")}});return p})},"MW/remote/iframeproxy/CheckUrlService":function(){define(["dojo/_base/declare",
"dojo/dom","dojo/on","dojo/request/script","MW/Log"],function(l,h,f,b,a){return function(c){var d,g,e;if(!c)throw Error("Expected a valid url in urlToEmptyJsFile");d={framedoc:null};g=b.get(c,d,!0);d=h.byId(g.id,d.frameDoc);e=f(d,"error",function(b){a.info("CheckUrlService detected an error accessing url: "+c);g.handleResponse(null,b);e.remove()});return g.promise}})},"dojo/request/script":function(){define("module ./watch ./util ../_base/kernel ../_base/array ../_base/lang ../on ../dom ../dom-construct ../has ../_base/window".split(" "),
function(l,h,f,b,a,c,d,g,e,m,n){function p(a,b){a.canDelete&&s._remove(a.id,b.options.frameDoc,!0)}function k(b){E&&E.length&&(a.forEach(E,function(a){s._remove(a.id,a.frameDoc);a.frameDoc=null}),E=[]);return b.options.jsonp?!b.data:!0}function u(a){return!!this.scriptLoaded}function r(a){return(a=a.options.checkString)&&eval("typeof("+a+') !\x3d\x3d "undefined"')}function v(a,b){if(this.canDelete){var e=this.response.options;E.push({id:this.id,frameDoc:e.ioArgs?e.ioArgs.frameDoc:e.frameDoc});e.ioArgs&&
(e.ioArgs.frameDoc=null);e.frameDoc=null}b?this.reject(b):this.resolve(a)}function s(a,b,e){var g=f.parseArgs(a,f.deepCopy({},b));a=g.url;b=g.options;var m=f.deferred(g,p,k,b.jsonp?null:b.checkString?r:u,v);c.mixin(m,{id:w+K++,canDelete:!1});b.jsonp&&(RegExp("[?\x26]"+b.jsonp+"\x3d").test(a)||(a+=(~a.indexOf("?")?"\x26":"?")+b.jsonp+"\x3d"+(b.frameDoc?"parent.":"")+w+"_callbacks."+m.id),m.canDelete=!0,D[m.id]=function(a){g.data=a;m.handleResponse(g)});f.notify&&f.notify.emit("send",g,m.promise.cancel);
if(!b.canAttach||b.canAttach(m)){var n=s._attach(m.id,a,b.frameDoc);if(!b.jsonp&&!b.checkString)var l=d(n,C,function(a){if("load"===a.type||N.test(n.readyState))l.remove(),m.scriptLoaded=a})}h(m);return e?m:m.promise}m.add("script-readystatechange",function(a,b){return"undefined"!==typeof b.createElement("script").onreadystatechange&&("undefined"===typeof a.opera||"[object Opera]"!==a.opera.toString())});var w=l.id.replace(/[\/\.\-]/g,"_"),K=0,C=m("script-readystatechange")?"readystatechange":"load",
N=/complete|loaded/,D=b.global[w+"_callbacks"]={},E=[];s.get=s;s._attach=function(a,b,e){e=e||n.doc;var c=e.createElement("script");c.type="text/javascript";c.src=b;c.id=a;c.async=!0;c.charset="utf-8";return e.getElementsByTagName("head")[0].appendChild(c)};s._remove=function(a,b,c){e.destroy(g.byId(a,b));D[a]&&(c?D[a]=function(){delete D[a]}:delete D[a])};s._callbacksProperty=w+"_callbacks";return s})},"MW/remote/messageserviceimpl/MessageServiceBase":function(){define("dojo/_base/declare dojo/_base/json dojo/_base/lang dojo/aspect dojo/Deferred MW/utils/StateMachine MW/Log ./MessageServiceState".split(" "),
function(l,h,f,b,a,c,d,g){return l([g],{logSubscriptions:!1,constructor:function(){this.batching=!0;this.typeSerializers=[];this.typeDeserializers={};this.channelSubscriptions={}},setDelegate:function(a){this.inherited(arguments);b.after(this._delegate,"onMessage",f.hitch(this,this.handleMessage),!0)},publish:function(a,b){if(this.isConnected()||"resubscribing"===this._currentState){var c=this._queuePublish(a,this.serialize(b));this._deferProcessQueue();return c}return this._queuePublish(a,this.serialize(b))},
subscribe:function(b,c,g){this.logSubscriptions&&d.info("MessageService subscribe: "+b,c,g);this._addHandler(this.channelSubscriptions,b,c,g);return this.isConnected()||"resubscribing"===this._currentState?(b=this._queueSubscribe(b,c,g),this._deferProcessQueue(),b):(new a).resolve()},unsubscribe:function(b,c,g){this.logSubscriptions&&d.info("MessageService unsubscribe: "+b,c,g);if(this._removeHandler(this.channelSubscriptions,b,c,g))return this.isConnected()||"resubscribing"===this._currentState?
(b=this._queueUnsubscribe(b,c,g),this._deferProcessQueue(),b):(new a).resolve();d.error("Not subscribed to channel: "+b+", can't unsubscribe.");return(new a).reject("Not subscribed to channel: "+b+", can't unsubscribe.")},flush:function(){if(this.isConnected())this._processQueue();else throw Error("Can only manually flush the queue when connected.");},setLatency:function(a){this._delegate&&this._delegate.doSetLatency&&this._delegate.doSetLatency(a)},setErrorRate:function(a){this._delegate&&this._delegate.doSetErrorRate&&
this._delegate.doSetErrorRate(a)},_enterDisconnected:function(){this.inherited("_enterDisconnected",arguments);this._queuedOps=[]},_enterConnecting:function(){this.inherited("_enterConnecting",arguments);Object.keys(this.channelSubscriptions).forEach(function(a){a.subscribed=!1})},_enterConnected:function(){this.inherited("_enterConnected",arguments);this._processQueue()},_enterDisconnecting:function(){this._processQueue();this.inherited("_enterDisconnecting",arguments)},_queuePublish:function(b,
c){var d=new a;this._queuedOps.push({type:"publish",channel:b,data:c,deferred:d});return d.promise},_queueSubscribe:function(b,c,d){var g=new a;this._queuedOps.push({type:"subscribe",channel:b,handler:c,scope:d,deferred:g});return g.promise},_queueUnsubscribe:function(b,c,d){for(var g=new a,f,h=0;h<this._queuedOps.length;h++)if(f=this._queuedOps[h],"subscribe"===f.type&&f.channel===b&&f.handler===c&&f.scope===d)return this._queuedOps.splice(h,1),f.deferred.resolve(),(new a).resolve();this._queuedOps.push({type:"unsubscribe",
channel:b,handler:c,scope:d,deferred:g});return g.promise},_processQueue:function(){var a=this._delegate&&this._delegate.delegateConnected();(!this.isConnected()||!a)&&"disconnecting"!==this._currentState||(this._delegate.doStartBatch(),a=this._queuedOps,this._queuedOps=[],a.forEach(function(a){var b;"publish"===a.type?b=this._delegate.doPublish(a.channel,a.data):"subscribe"===a.type?b=this._doSubscribe(a.channel,a.handler,a.scope):"unsubscribe"===a.type&&(b=this._doUnsubscribe(a.channel,a.handler,
a.scope));b.then(a.deferred.resolve,a.deferred.reject)},this),this._delegate.doEndBatch())},_deferProcessQueue:function(){if(this.batching&&!this._deferredTimeout){var a=this;this._deferredTimeout=setTimeout(function(){a._deferredTimeout=!1;a._processQueue()},0)}else this.batching||this._processQueue()},_doSubscribe:function(b){if(this.channelSubscriptions[b].subscribed)return(new a).resolve();var c=this._delegate.doSubscribe(b);this.channelSubscriptions[b].subscribed=!0;return c},_doUnsubscribe:function(b){return this.channelSubscriptions[b]?
(new a).resolve():this._delegate.doUnsubscribe(b)},handleMessage:function(a){var b;if(a&&a.channel){a.data&&(a.data=this.deserialize(a.data));var c=a.channel.split("/");for(b=1;b<=c.length;b+=1)this._callHandlers(this.channelSubscriptions,c.slice(0,b).concat("**").join("/"),a);this._callHandlers(this.channelSubscriptions,c.slice(0,c.length-1).concat("*").join("/"),a);this._callHandlers(this.channelSubscriptions,c.concat("*").join("/"),a);this._callHandlers(this.channelSubscriptions,a.channel,a)}},
registerMessageHandler:function(a,b,c){d.error("registerMessageHandler is not supported any more.")},deregisterMessageHandler:function(a,b,c){d.error("deregisterMessageHandler is not supported any more.")},registerTypeSerializer:function(a,b,c){this.typeSerializers.push({typeMatcher:a,type:b,serializer:c})},registerTypeDeserializer:function(a,b){this.typeDeserializers[a]=b},serialize:function(a){return f.isArray(a)?this._serializeArray(a):a instanceof Number||a instanceof Boolean||f.isString(a)?a:
this._serializeObject(a)},deserialize:function(a){return f.isArray(a)?this._deserializeArray(a):a instanceof Number||a instanceof Boolean||f.isString(a)?a:this._deserializeObject(a)},_addHandler:function(a,b,c,g){var f;g=g||this;"string"===typeof c&&"function"!==typeof g[c]?d.warn("Not adding invalid handler: "+c):(f=a[b],f||(f=[],a[b]=f),a={channel:b,handler:c,scope:g},f.push(a),f.sort(function(a){return a.exclusive?-1:0}))},_removeHandler:function(a,b,c,d){var g;g=a[b];c=this._getHandlerIndex(g,
{handler:c,scope:d||this});0<=c&&g.splice(c,1);(!g||0===g.length)&&delete a[b];return 0<=c},_callHandlers:function(a,b,c){var g;if(a.hasOwnProperty(b)){a=a[b];for(g=0;g<a.length;g+=1)try{"string"===typeof a[g].handler?a[g].scope[a[g].handler].call(a[g].scope,c):a[g].handler.call(a[g].scope,c)}catch(f){d.error("Error while executing message handler on channel: "+b+", message: "+h.toJson(c)+", error: "+f)}}},_getHandlerIndex:function(a,b){if(!a)return-1;var c;for(c=0;c<a.length;c+=1)if(b.handler===
a[c].handler&&b.scope===a[c].scope)return c;return-1},_serializeObject:function(a){var b,c;for(c=0;c<this.typeSerializers.length;c+=1){var d=this.typeSerializers[c];if(d.typeMatcher(a))return{__type__:d.type,__value__:d.serializer.call(this,a)}}if(a instanceof Image)return a;for(b in a)a.hasOwnProperty(b)&&(a[b]=this.serialize(a[b]));return a},_serializeArray:function(a){var b,c=a.length;for(b=0;b<c;b+=1)a[b]=this.serialize(a[b]);return a},_deserializeObject:function(a){var b;if(void 0===a||null===
a)return null;if(a.hasOwnProperty("__type__")&&a.hasOwnProperty("__value__"))try{return this.typeDeserializers[a.__type__].call(this,a.__value__)}catch(c){d.error("Error while trying to deserialize: ",a)}for(b in a)a.hasOwnProperty(b)&&(null!==a[b]&&void 0!==a[b])&&(a[b]=this.deserialize(a[b]));return a},_deserializeArray:function(a){var b,c=a.length;for(b=0;b<c;b+=1)a[b]=this.deserialize(a[b]);return a}})})},"MW/utils/StateMachine":function(){define(["dojo/_base/declare","./statemachineimpl/State"],
function(l,h){return l([],{constructor:function(f){f.stateMachine=this;this.state=new h(f)},start:function(){this.state.enter()},stop:function(){this.state.exit()},_changeState:function(f,b){this.state.enter(f,b)},onEnterState:function(f){},onExitState:function(f){}})})},"MW/utils/statemachineimpl/State":function(){define("dojo/_base/declare dojo/_base/lang MW/Log ./EventTrigger ./MessageTrigger ./RemoteTrigger ./TimeoutTrigger ./Transition".split(" "),function(l,h,f,b,a,c,d,g){var e;return e=l([],
{constructor:function(a){this.stateMachine=a.stateMachine||{_changeState:function(){},onEnterState:function(){},onExitState:function(){}};this.namespace=a.namespace||"";this.name=a.name||this.getDefaultName();this.context=a.context||{};this.data=a.data||{};this.composition=a.composition||"XOR";this.defaultSubstate=a.defaultSubstate||"";this.constructSubstates(a.substates);this.constructTriggersAndTransitions(a.transitions);this.active=a.active||!1},getDefaultName:function(){var a;0<this.namespace.length?
(a=this.namespace.split("."),a=a.pop()):f.warn("State: state name is not specified.");return a||""},constructSubstates:function(a){var b={},c,d;for(c in a)a.hasOwnProperty(c)&&(d=a[c],d.name&&d.name!==c&&f.error("State: error constructing substate: "+c+", the specified names don't match: "+d.name),d.name=c,d.namespace=d.namespace||[this.namespace,this.name].join("."),d.stateMachine=d.stateMachine||this.stateMachine,d.context=d.context||this.context,b[d.name]=new e(d));this.substates=b},constructTriggersAndTransitions:function(a){var b,
c={},d=[],e;for(b in a)a.hasOwnProperty(b)&&((e=this.constructTrigger(b))&&d.push(e),c[b]=this.constructTransition(b,a[b]));this.transitions=c;this.triggers=d},constructTrigger:function(e){var g,f,k;g=e.split(" ");if(2===g.length)"subscribe"===g[0]?k=a:"response"===g[0]||"fault"===g[0]?k=c:"timeout"===g[0]&&(k=d);else if("onEnterState"!==e||"onExitState"!==e)k=b;k&&(f=new k({name:e,context:this.context,triggerHandler:h.hitch(this,this.handleTrigger)}));return f},constructTransition:function(a,b){var c;
if(h.isFunction(b)||h.isString(b)||h.isArray(b))"onEnterState"===a||"onExitState"===a?(c=b,b={},b.action=c,b.target=""):(c=b,b={},b.target=c);b.state=this;return new g(b)},enter:function(a,b){this.active||(this.active=!0,this.enableTriggers(),this.stateMachine.onEnterState(this.name),this.handleTrigger.apply(this,["onEnterState"].concat(b)));a?this.changeSubstates(a,b):this.changeToDefaultSubstate(b)},exit:function(){var a=this.activeSubstates();this.active=!1;this.disableTriggers();a.forEach(function(a){a.exit()});
this.handleTrigger("onExitState");this.stateMachine.onExitState(this.name)},enableTriggers:function(){this.triggers.forEach(function(a){a.enable()})},disableTriggers:function(){this.triggers.forEach(function(a){a.disable()})},handleTrigger:function(a){var b,c;if(this.transitions[a]&&(c=Array.prototype.slice.call(arguments,1,arguments.length),b=this.transitions[a].handleTrigger(a,c)))h.isString(b)||(c=b.args,b=b.target),this.stateMachine._changeState(b,c)},changeSubstates:function(a,b){var c=this.activeSubstates();
this.substates[a]&&(0<=c.length&&c[0].name!==a&&c.forEach(function(a){a.exit()}),this.substates[a].enter(void 0,b))},changeToDefaultSubstate:function(a){0===this.activeSubstates().length&&this.substates[this.defaultSubstate]&&this.substates[this.defaultSubstate].enter(void 0,a)},activeSubstates:function(){var a=[],b;for(b in this.substates)this.substates.hasOwnProperty(b)&&this.substates[b].active&&a.push(this.substates[b]);return a}})})},"MW/utils/statemachineimpl/EventTrigger":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/aspect","MW/Log","./Trigger"],function(l,h,f,b,a){return l(a,{constructor:function(){this.connection={}},enable:function(){h.isFunction(this.context[this.name])&&(this.cachedFunction=this.context[this.name]);this.connection=f.after(this.context,this.name,h.hitch(null,this.triggerHandler,this.name),!0)},disable:function(){this.connection.remove();this.cachedFunction&&(this.context[this.name]=this.cachedFunction)}})})},"MW/utils/statemachineimpl/Trigger":function(){define(["dojo/_base/declare"],
function(l){return l([],{constructor:function(h){this.name="";this.context={};this.triggerHandler=h.triggerHandler||function(){};l.safeMixin(this,h)},enable:function(){},disable:function(){}})})},"MW/utils/statemachineimpl/MessageTrigger":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","MW/Log","./Trigger"],function(l,h,f,b,a){return l(a,{constructor:function(){var a=this.name.split(" ");(2>a.length||"subscribe"!==a[0])&&b.error("Invalid trigger name for a MessageTrigger. Could not parse out the message name.");
this.messageId=a[1]||"";this.subscrition={}},enable:function(){this.subscription=f.subscribe(this.messageId,h.hitch(null,this.triggerHandler,this.name))},disable:function(){this.subscription.remove()}})})},"MW/utils/statemachineimpl/RemoteTrigger":function(){define(["dojo/_base/declare","dojo/_base/lang","MW/Log","MW/remote/Remote","./Trigger"],function(l,h,f,b,a){return l(a,{constructor:function(){var a=this.name.split(" ");(2>a.length||"response"!==a[0]&&"fault"!==a[0])&&f.error("Invalid trigger name for a RemoteTrigger. Could not parse out the type of handler.");
(!b.registerResponseHandler||!b.registerFaultHandler)&&f.error("The remote package is not available, this type of trigger will not work.");this.messageId=a[1]||"";this.handlerType=a[0]},enable:function(){"response"===this.handlerType?b.registerResponseHandler(this.messageId,h.hitch(null,this.triggerHandler,this.name)):b.registerFaultHandler(this.messageId,h.hitch(null,this.triggerHandler,this.name))},disable:function(){"response"===this.handlerType?b.deregisterResponseHandler(this.messageId):b.deregisterFaultHandler(this.messageId)}})})},
"MW/remote/Remote":function(){define("dojo/_base/lang dojo/aspect ./iframeproxy/IframeProxyClient ./iframeproxy/IframeJsonTransaction ./impl/FaultManager ./impl/RequestManager ./impl/ResponseManager ./impl/Transaction ./RemoteEndPointsManager ../Log ./serviceRegistryLookup!".split(" "),function(l,h,f,b,a,c,d,g,e,m,n){var p=this,k;k={reset:function(){var u=[],r=new a,v=new d({faultManager:r}),s=new c({responseManager:v});k.faultManager=r;k.responseManager=v;k.requestManager=s;k._serviceRegistryLookup=
n;var w=k.proxyClient=new f;k.createUploadIframeTarget=l.hitch(w,w.createUploadIframeTarget);k.cancelUpload=l.hitch(w,w.cancelUpload);e.setIframeProxyClientForEndPoint(e.getEndPointNames().ROUTER_LEAF_SECURE_ENDPOINT,w);e.setIframeProxyClientForEndPoint(e.getEndPointNames().ROUTER_LEAF_INSECURE_ENDPOINT,w);g.construct=function(a){a=a||{};e.getRoutingHost(e.getEndPointNames().ROUTER_LEAF_INSECURE_ENDPOINT)||k.setEndpoint();a.allowedMessages=u;a.sendMessage=k.sendMessage;a.computeSessionId=k.getComputeSessionId;
return new b(a)};k.registerEndpointLevelFaultHandler=l.hitch(r,r.registerEndpointLevelFaultHandler);k.sendMessage=l.hitch(s,s.sendMessage);k.registerDefaultMessageFactory=l.hitch(s,s.registerDefaultMessageFactory);k.deregisterDefaultMessageFactory=l.hitch(s,s.deregisterDefaultMessageFactory);k.registerResponseHandler=l.hitch(v,v.registerResponseHandler);k.deregisterResponseHandler=l.hitch(v,v.deregisterResponseHandler);k.registerFaultHandler=l.hitch(r,r.registerFaultHandler);k.deregisterFaultHandler=
l.hitch(r,r.deregisterFaultHandler);k.registerTopLevelFaultHandler=l.hitch(r,r.registerTopLevelFaultHandler);k.deregisterTopLevelFaultHandler=l.hitch(r,r.deregisterTopLevelFaultHandler);k.setServiceEndPoint=function(a,b,c){e.setRoutingHostAndRoutingKey(a,b,c)};k.setServicePathSuffixForEndPoint=function(a,b){e.setPathSuffixForEndPoint(a,b)};k.ignoreTopLevelFault=k.registerTopLevelFaultHandler;k.setComputeToken=function(a){s.computeToken=a};k.setWorkerEndpoint=function(a,b){e.setRoutingHostAndRoutingKey(e.getEndPointNames().WORKER_ENDPOINT,
a,b)};k.setEndpoint=function(a){a||(a=k._serviceRegistryLookup.getServiceRegistryEndpoint("primary"),a||(m.info("ServiceRegistryLookup is empty, falling back to localhost"),a="/"));if(!a||"/"===a)a=p.location.protocol+"//"+p.location.host+"/";e.setRoutingHostAndRoutingKey(e.getEndPointNames().ROUTER_LEAF_SECURE_ENDPOINT,a);e.setRoutingHostAndRoutingKey(e.getEndPointNames().ROUTER_LEAF_INSECURE_ENDPOINT,a);w.setRemotePageHost(a)};k.setAllowedMessages=function(a){u=a};k.allowAllMessages=function(){u=
[]};k.getEndPoint=function(){return e.getRoutingHost(e.getEndPointNames().ROUTER_LEAF_SECURE_ENDPOINT)};k.getUploadIframeProxyUrl=function(){return k.getEndPoint()+w.getUploadIframeProxyUrlPath()};k.getComputeSessionId=function(){return s.computeToken?s.computeToken.computeSessionId:12345};k.getWorkerRoutingHost=function(){var a=e.getRoutingHost(e.getEndPointNames().WORKER_ENDPOINT);return a?a:location.protocol+"//"+location.host+"/"};k.getWorkerRoutingKey=function(){return e.getRoutingKey(e.getEndPointNames().WORKER_ENDPOINT)};
k.enableServerOnWorkerAsync=function(){e.enableEndPoint(e.getEndPointNames().WORKER_ASYNC_ENDPOINT)};k.disableServerOnWorkerAsync=function(){e.disableEndPoint(e.getEndPointNames().WORKER_ASYNC_ENDPOINT)};k.isServerOnWorkerAsyncEnabled=function(){return e.isEndPointEnabled(e.getEndPointNames().WORKER_ASYNC_ENDPOINT)};k.enableServerOnWorker=function(){e.enableEndPoint(e.getEndPointNames().WORKER_ENDPOINT)};k.disableServerOnWorker=function(){e.disableEndPoint(e.getEndPointNames().WORKER_ENDPOINT)};k.isWorkerEndpointEnabled=
function(){return e.isEndPointEnabled(e.getEndPointNames().WORKER_ENDPOINT)};k.setWorkerOnlyMessageTypes=function(a){e.setMessageTypesToEndPoint(e.getEndPointNames().WORKER_ENDPOINT,a)};h.after(w,"onError",function(a){a&&r.handleNonTransactionFault(a)},!0)}};k.reset();return k})},"MW/remote/iframeproxy/IframeJsonTransaction":function(){define(["dojo/_base/declare","MW/remote/impl/JsonTransaction","MW/remote/RemoteEndPointsManager"],function(l,h,f){return l([h],{constructor:function(b){b=b||{};this.proxyClient=
b.proxyClient;this.workerProxyClient=b.workerProxyClient;this.routingHost=b.routingHost;this.routingKey=b.routingKey;this.computeSessionId=b.computeSessionId},_doSend:function(b){return f.getIframeProxyClientForEndPoint(this.endPointName).sendMessage(b,f.getRemoteUrlForEndPoint(this.endPointName))}})})},"MW/remote/impl/JsonTransaction":function(){define("dojo/_base/declare dojo/_base/xhr dojo/_base/json dojo/_base/lang MW/remote/RemoteEndPointsManager ./Transaction".split(" "),function(l,h,f,b,a,
c){return l(c,{constructor:function(a){a=a||{};this.uuid=a.uuid||this._generateUuid()},_getRequest:function(b){var c=null;a.isEndpointMessageContainerBased(this.endPointName)?(c={uuid:this.uuid,messages:b},this.computeToken&&(c.computeToken=this.computeToken)):Object.keys(b).forEach(function(a){c=b[a]});this._sanitizeForJson(c);return f.toJson(c)},_sanitizeForJson:function(a){var c;if(b.isArray(a))a.forEach(this._sanitizeForJson,this);else if(b.isObject(a))for(c in a)a.hasOwnProperty(c)&&(void 0===
a[c]?delete a[c]:(b.isObject(a[c])||b.isArray(a[c]))&&this._sanitizeForJson(a[c]))},_doSend:function(a){return h.post({url:this._getEndpoint(),contentType:"application/json",handleAs:"json",postData:a})},_processResponse:function(a){this.stopTime=(new Date).getTime();a?(a.fault&&(this.fault=a.fault),this.responseMessages=a.messages?a.messages:a):this.fault={faultCode:"Connection.Fault",message:"Unable to communicate with server, no response."}},_processFault:function(a){this.stopTime=(new Date).getTime();
this.fault={faultCode:"Connection.Fault",message:a}}})})},"MW/remote/RemoteEndPointsManager":function(){define(["MW/remote/EndPointsManager"],function(l){var h=null;null===h&&(h=new l);return h})},"MW/remote/EndPointsManager":function(){define(["dojo/_base/declare","dojo/_base/array","./iframeproxy/IframeProxyClient"],function(l,h,f){return l([],{constructor:function(){this._initializeEndPointsCollection()},_initializeEndPointsCollection:function(){this.endPointsCollection={ROUTER_LEAF_INSECURE_ENDPOINT:{routingHost:"",
routingKey:"",iframeProxy:null,enabled:!0,iframeProxyUrl:"",pathSuffix:"messageservice/json",messages:"RouterLogin CreateAccount CurrentUser Login UpdateAccount ServiceRegistry ClientType AuthorizationDetails".split(" "),iframeProxyName:"remoteProducer",acceptsMessageContainerMessages:!0},ROUTER_LEAF_SECURE_ENDPOINT:{routingHost:"",routingKey:"",iframeProxy:null,enabled:!0,iframeProxyUrl:"",pathSuffix:"messageservice/json/secure",messages:[],iframeProxyName:"remoteProducer",acceptsMessageContainerMessages:!0},
WORKER_ENDPOINT:{routingHost:"",routingKey:"",iframeProxy:null,enabled:!1,iframeProxyUrl:"",pathSuffix:"messageservice/json/secure",messages:[],iframeProxyName:"remoteWorkerProducer",acceptsMessageContainerMessages:!0},WORKER_ASYNC_ENDPOINT:{routingHost:"",routingKey:"",iframeProxy:null,enabled:!0,iframeProxyUrl:"",pathSuffix:"messageservice/async",messages:[],acceptsMessageContainerMessages:!0},USAGE_DATA_ROUTER_ENDPOINT:{routingHost:"",routingKey:"",iframeProxy:null,enabled:!0,iframeProxyUrl:"",
pathSuffix:"udc/service/v1/events",messages:["UsageDataEventCollection"],iframeProxyName:"remoteUDCProducer",acceptsMessageContainerMessages:!1},HELP_DATA_ROUTER_ENDPOINT:{routingHost:"",routingKey:"",iframeProxy:null,enabled:!0,iframeProxyUrl:"",pathSuffix:"",messages:["HelpDataEventCollection"],iframeProxyName:"doc_center",acceptsMessageContainerMessages:!1}}},reset:function(){this._initializeEndPointsCollection()},setUpNewEndPoint:function(b,a,c,d,g){this.endPointsCollection[b]={routingHost:"",
routingKey:"",pathSuffix:c,enabled:a,messages:[],iframeProxy:null,iframeProxyName:d,acceptsMessageContainerMessages:g}},getPathSuffixForEndPoint:function(b){return this.endPointsCollection[b].pathSuffix},setPathSuffixForEndPoint:function(b,a){this.endPointsCollection[b].pathSuffix=a},getEndPointNames:function(){var b={},a;for(a in this.endPointsCollection)this.endPointsCollection.hasOwnProperty(a)&&(b[a]=a);return b},setRoutingHostAndRoutingKey:function(b,a,c){a&&a.lastIndexOf("/")!==a.length-1&&
(a+="/");this.endPointsCollection[b].routingHost=a;c&&(this.endPointsCollection[b].routingKey=c);a&&this._setIframeRoutingHostAndRoutingkey(b)},_setIframeRoutingHostAndRoutingkey:function(b){var a=this.getIframeProxyClientForEndPoint(b);a&&a.setRemotePageHost(this.endPointsCollection[b].routingHost,this.endPointsCollection[b].routingKey,null,this.endPointsCollection[b].iframeProxyUrl)},getRoutingHost:function(b){return this.endPointsCollection[b].routingHost},getRoutingKey:function(b){return this.endPointsCollection[b].routingKey},
getMessageTypesMappedToEndPoint:function(b){return this.endPointsCollection[b].messages},isEndPointEnabled:function(b){return this.endPointsCollection[b].enabled},setMessageTypesToEndPoint:function(b,a){this.endPointsCollection[b].messages=a},enableEndPoint:function(b){this.endPointsCollection[b].enabled=!0},disableEndPoint:function(b){this.endPointsCollection[b].enabled=!1},getEndPointForMessageType:function(b){var a=null,c;for(c in this.endPointsCollection)if(this.endPointsCollection.hasOwnProperty(c)&&
(a=-1<h.lastIndexOf(this.endPointsCollection[c].messages,b)?c:a))if(this.isEndPointEnabled(a))break;else a=null;return a?a:this.getEndPointNames().ROUTER_LEAF_SECURE_ENDPOINT},getRemoteUrlForEndPoint:function(b){var a=this.endPointsCollection[b].routingHost+this.endPointsCollection[b].pathSuffix;this.endPointsCollection[b].routingKey&&(a=a+"?routingkey\x3d"+this.endPointsCollection[b].routingKey);return a},setIframeProxyClientForEndPoint:function(b,a){this.endPointsCollection[b].iframeProxy=a},getIframeProxyClientForEndPoint:function(b){var a=
this.endPointsCollection[b].iframeProxy;a||(a=new f(this.endPointsCollection[b].iframeProxyName),this.endPointsCollection[b].iframeProxy=a);return a},isEndpointMessageContainerBased:function(b){return b&&this.endPointsCollection[b]?this.endPointsCollection[b].acceptsMessageContainerMessages:!0},addMessagesTypesToEndPoint:function(b,a){this.endPointsCollection[b]&&-1===this.endPointsCollection[b].messages.indexOf(a)&&this.endPointsCollection[b].messages.push(a)},removeMessageTypesFromEndPoint:function(b,
a){if(this.endPointsCollection[b]){var c=this.endPointsCollection[b].messages.indexOf(a);-1<c&&this.endPointsCollection[b].messages.splice(c,1)}}})})},"MW/remote/impl/Transaction":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","MW/remote/RemoteEndPointsManager","MW/utils/Utils"],function(l,h,f,b,a){return l([],{constructor:function(a){a=a||{};this.requestMessages=a.requestMessages||{};this.responseMessages=a.responseMessages||{};this.context=a.context;this.computeToken=
a.computeToken;this.uuidClassifierMap=a.uuidClassifierMap||{};this.endPointName=a.endPointName||null;this.allowedMessages=a.allowedMessages||[];this.ignoreMessageTypes=a.ignoreMessageTypes||[];this.sendMessage=a.sendMessage},addRequestMessage:function(a,d,g){if(d){var e=b.isEndpointMessageContainerBased(this.endPointName);this.requestMessages[a]||(this.requestMessages[a]=[]);f.isArray(d)?d.forEach(function(b){this.addRequestMessage(a,b,g)},this):e?(d.uuid=d.uuid||this._generateUuid(),g&&(this.uuidClassifierMap[d.uuid]=
g),this.requestMessages[a].push(d)):this.requestMessages[a]=d;this.requestMessages=this._filterMessages(this.requestMessages)}},_filterMessages:function(a){var b={};this.getRequestMessageTypes().forEach(function(g){if(0===this.allowedMessages.length||0<=this.allowedMessages.indexOf(g))b[g]=a[g]},this);return b},getResponseMessageTypes:function(){var a,b=[];for(a in this.responseMessages)this.responseMessages.hasOwnProperty(a)&&b.push(a);return b},getRequestMessageTypes:function(){var a,b=[];for(a in this.requestMessages)this.requestMessages.hasOwnProperty(a)&&
b.push(a);return b},getMessageClassifier:function(a){return a&&a.uuid&&this.uuidClassifierMap.hasOwnProperty(a.uuid)?this.uuidClassifierMap[a.uuid]:""},send:function(){this._removeEmptyMessages();this._isEmpty(this.requestMessages)?(this.deferred=new h,this.deferred.callback()):(this.startTime=(new Date).getTime(),this.deferred=this._doSend(this._getRequest(this.requestMessages)),this.deferred.addCallback(this,this._processResponse),this.deferred.addErrback(this,this._processFault))},addIgnoreMessageType:function(a,
b){if(-1<this.getRequestMessageTypes().indexOf(a))if(b)for(var g in this.uuidClassifierMap)this.uuidClassifierMap.hasOwnProperty(g)&&(b&&this.uuidClassifierMap[g]===b)&&this.ignoreMessageTypes.push(a+":"+b);else this.ignoreMessageTypes.push(a)},_removeEmptyMessages:function(){if(!this._isEmpty(this.requestMessages))for(var b in this.requestMessages)this.requestMessages.hasOwnProperty(b)&&f.isArray(this.requestMessages[b])&&0===a.getArrayLength(this.requestMessages[b])&&delete this.requestMessages[b]},
_isEmpty:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},_generateUuid:function(){return a.generateUuid()}})})},"MW/utils/Utils":function(){define(["dojo/_base/lang","dojo/_base/window"],function(l,h){return{generateUuid:function(){return"xxxxxxxx".replace(/[xy]/g,function(f){var b=16*Math.random()|0;return("x"===f?b:b&3|8).toString(16)}).toUpperCase()},isImageData:function(f){return!!f&&(h.global.ImageData&&f instanceof h.global.ImageData||f.hasOwnProperty("width")&&f.hasOwnProperty("height")&&
f.hasOwnProperty("data"))},getArrayLength:function(f){var b=0;if(!l.isArray(f))return!1;f.forEach(function(a){a&&(b+=1)});return b},isWhitespace:function(f){return/^\s+$/.test(f)},removeSurroundingNewLines:function(f){for(;"\n"===f.charAt(0);)f=f.substring(1);for(;"\n"===f.charAt(f.length-1);)f=f.substring(0,f.length-1);return f},getFirstUniqueElement:function(f,b){var a=null;b.some(function(b){if(-1===f.indexOf(b))return a=b,!0});return a},unionOfWordSets:function(f,b,a){f=this._stringToArray(f);
b=this._stringToArray(b);f=this.unionOfArrays(f,b);return a?f.join(" "):f},intersectionOfWordSets:function(f,b,a){f=this._stringToArray(f);b=this._stringToArray(b);f=this.intersectionOfArrays(f,b);return a?f.join(" "):f},differenceOfWordSets:function(f,b,a){f=this._stringToArray(f);b=this._stringToArray(b);f=this.differenceOfArrays(f,b);return a?f.join(" "):f},unionOfArrays:function(f,b){return this.unique(f.concat(b))},intersectionOfArrays:function(f,b){return this.nonunique(f.concat(b))},differenceOfArrays:function(f,
b){return this.unique(f.filter(function(a){return-1===b.indexOf(a)}))},unique:function(f){return f.filter(function(b,a){return f.indexOf(b)===a})},nonunique:function(f){return this.unique(f.filter(function(b,a){return f.indexOf(b)!==a}))},removeEmptyElements:function(f){return f.filter(function(b){return!(""===b||null===b||void 0===b)})},_stringToArray:function(f){return!this._isString(f)?f:this.removeEmptyElements(f.split(" "))},_isString:function(f){return"string"===typeof f||f instanceof String}}})},
"MW/remote/impl/FaultManager":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","MW/remote/RemoteEndPointsManager"],function(l,h,f,b){return h([],{constructor:function(a){a=a||{};this.faultHandlers=a.faultHandlers||{};this.topLevelHandlers=a.topLevelHandlers||[];this.endPointLevelHandlers=a.endPointLevelHandlers||{}},registerFaultHandler:function(a,b,d){d&&(b=f.hitch(d,b));this.faultHandlers[a]=b},deregisterFaultHandler:function(a){delete this.faultHandlers[a]},registerTopLevelFaultHandler:function(a,
b,d){d&&(b=f.hitch(d,b));if(f.isString(a)){if("*"===a)return a={matcher:a,handler:b},this.defaultTopLevelHandler=b,a;a=this._constructMatcherFromQuery(a)}a={matcher:a,handler:b};this.topLevelHandlers.push(a);return a},registerEndpointLevelFaultHandler:function(a,b,d,g){g&&(d=f.hitch(g,d));f.isString(b)&&(b=this._constructMatcherFromQuery(b));b={matcher:b,handler:d};this.endPointLevelHandlers[a]||(this.endPointLevelHandlers[a]=[]);this.endPointLevelHandlers[a].push(b);return b},deregisterTopLevelFaultHandler:function(a){var b=
this.topLevelHandlers.indexOf(a);-1<b?this.topLevelHandlers.splice(b,1):"*"===a.matcher&&delete this.defaultTopLevelHandler},_constructMatcherFromQuery:function(a){var b=[];a.split("||").forEach(function(a){a=f.trim(a);a=a.replace(/([\.])/g,"\\$1");a=a.replace(/\*/g,".*");b.push(RegExp("^"+a+"$"))});return function(a){return l.some(b,function(b){return b.test(a.faultCode||a.code||"")})}},handleFault:function(a){var b,d=function(b,c){var d;if(d=a.getMessageClassifier(c))if(d=[b,d].join(":"),this.faultHandlers[d])this.faultHandlers[d](a.fault,
a.context)};for(b in a.requestMessages)if(a.requestMessages.hasOwnProperty(b)){if(this.faultHandlers[b])this.faultHandlers[b](a.fault,a.context);var g=a.requestMessages[b];g instanceof Array&&g.forEach(f.hitch(this,d,b))}if(this.faultHandlers["*"])this.faultHandlers["*"](a.fault,a.context);this.endPointLevelHandlers[a.endPointName]?this._handleEndpointLevelFault(a):this._handleTopLevelFault(a)},_handleEndpointLevelFault:function(a){var b=!1,d=l.filter(this.endPointLevelHandlers[a.endPointName],function(b){return b.matcher.call(this,
a.fault,a.context)},this);0<d.length&&d[0].handler&&(b=!0,d[0].handler.call(this,a.fault,a.context,a));return b},_handleTopLevelFault:function(a){var b=l.filter(this.topLevelHandlers,function(b){return b.matcher.call(this,a.fault,a.context)},this);(b=0<b.length?b[0].handler:this.defaultTopLevelHandler)&&b.call(this,a.fault,a.context,a)},handleNonTransactionFault:function(a){var b=l.filter(this.topLevelHandlers,function(b){return b.matcher.call(this,a)},this);(b=0<b.length?b[0].handler:this.defaultTopLevelHandler)&&
b.call(this,a)}})})},"MW/remote/impl/RequestManager":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/Deferred dojo/_base/lang MW/remote/RemoteEndPointsManager MW/remote/defaultMessageMapping ./Transaction".split(" "),function(l,h,f,b,a,c,d){return h([],{defaultMapping:c,constructor:function(a){a=a||{};this.defaultFactories=a.defaultFactories||{};this.mockHandlers=a.mockHandlers||{};this.mapping=a.mapping||this.defaultMapping;this.responseManager=a.responseManager},registerDefaultMessageFactory:function(a,
c,d){d&&(c=b.hitch(d,c));this.defaultFactories[a]=c},deregisterDefaultMessageFactory:function(a){delete this.defaultFactories[a]},registerMockResponseGenerator:function(a,c,h){var l=this;c=b.hitch(h||this,c);this.mockHandlers[a]=function(a,b){var g,h=d.construct(b);g=c(a,h);g||(g=new f,g.callback());g.addCallback(function(){l.responseManager._processResult(h)})}},deregisterMockResponseGenerator:function(a){delete this.mockHandlers[a]},sendMessage:function(a,b,c){var d={},f={};b=b||{};this._createAndFillTransactions(a,
b,c,d,f);a=Object.keys(d);for(b=0;b<a.length;b+=1)c=a[b],this._callMocks(f[c]),d[c].send(),this.responseManager.handleTransaction(d[c])},_getTransaction:function(a,b){return d.construct({context:b,computeToken:this.computeToken,endPointName:a})},_getMockTransaction:function(a,b,c){return d.construct({context:b,computeToken:this.computeToken,endPointName:a,uuid:c})},_createAndFillTransactions:function(b,c,d,f,h){var k,l,r=function(b){var d,g,k,l,m;d=a.getEndPointForMessageType(b);l=f[d];m=h[d];l||
(l=this._getTransaction(d,c),m=this._getMockTransaction(d,c,l.uuid),f[d]=l,h[d]=m);if(this.defaultFactories[b]&&(d=this.defaultFactories[b](l.context)))g=b.split(":"),k=g[0],g=g.slice(1,g.length).join(":"),this.mockHandlers[b]||l.addRequestMessage(k,d,g),m.addRequestMessage(k,d,g)},v,s;for(k in b)b.hasOwnProperty(k)&&(l=a.getEndPointForMessageType(k),v=h[l],s=f[l],f[l]||(s=this._getTransaction(l,c),v=this._getMockTransaction(l,c,s.uuid),f[l]=s,h[l]=v),l=[k,d].join(":"),!this.mockHandlers[k]&&!this.mockHandlers[l]&&
s.addRequestMessage(k,b[k],d),v.addRequestMessage(k,b[k],d),this.mapping[l]?this.mapping[l].forEach(r,this):this.mapping[k]&&this.mapping[k].forEach(r,this))},_callMocks:function(a){var c,d,f=a.context;delete a.context;var h=function(a,b){var d;if(d=c.getMessageClassifier(b))if(d=[a,d].join(":"),this.mockHandlers[d])this.mockHandlers[d]([b],c)};for(d in a.requestMessages)if(a.requestMessages.hasOwnProperty(d)){c=b.mixin({},a);c.context=f;if(this.mockHandlers.hasOwnProperty(d))this.mockHandlers[d](c.requestMessages[d],
c);c.requestMessages[d]instanceof Array?c.requestMessages[d].forEach(b.hitch(this,h,d)):h(d,c.requestMessages[d])}if(this.mockHandlers["*"])this.mockHandlers["*"](d,c.requestMessages[d],c)}})})},"MW/remote/defaultMessageMapping":function(){define([],function(){return{Eval:["CurrentFolder","ListFolder"],"Eval:Ping":[],"Eval:RunFile":["UpdateFile","CurrentFolder","ListFolder"],"Eval:MlsPublishPre":["UpdateFile"],"FEval:liveEvalInstrumentCode":[],Interrupt:[],"FEval:GetFigures":["CurrentFolder","ListFolder"],
"FEval:CloseFigure":["FEval:GetFigures"],"FEval:SelectFigure":["FEval:GetFigures"],"FEval:ResetAxes":["FEval:GetFigures"],"FEval:ResizeFigure":["FEval:GetFigures"],"FEval:AxesInteraction2D":["FEval:GetFigures"],"FEval:AxesInteraction3D":["FEval:GetFigures"],CurrentUser:["ServiceRegistry"],RouterLogin:["ServiceRegistry"],CurrentFolder:["ListFolder"],MoveFile:["CurrentFolder"],Variable:[],CloseFile:["SaveSession"],UpdateFile:["SaveSession"],SaveSession:["UpdateFile"],Logout:["CloseFile"],UpdateShare:["ListFolder"]}})},
"MW/remote/impl/ResponseManager":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/Deferred dojo/_base/json dojo/_base/lang MW/Log MW/remote/RemoteEndPointsManager".split(" "),function(l,h,f,b,a,c,d){return h([],{constructor:function(a){a=a||{};this.responseHandlers=a.responseHandlers||{};this.faultManager=a.faultManager;this.transactions=a.transactions||[]},registerResponseHandler:function(b,c,d){d&&(c=a.hitch(d,c));this.responseHandlers[b]=c},deregisterResponseHandler:function(a){delete this.responseHandlers[a]},
handleTransaction:function(b){this.transactions.push(b);b.deferred.addCallback(a.hitch(this,this._processAll,b));b.deferred.addCallback(a.hitch(this,this._processResult,b));b.deferred.addErrback(a.hitch(this,this._processAll,b));b.deferred.addErrback(a.hitch(this,this._processFault,b))},_processAll:function(a){a=this.transactions.indexOf(a);0<=a&&this.transactions.splice(a,1)},_processResult:function(a){a.getResponseMessageTypes().forEach(function(d){var f=a.responseMessages[d],h=[];try{if(f instanceof
Array){f.forEach(function(b){var c,f=a.getMessageClassifier(b);if(f){c=[d,f].join(":");var l=this,m=!1;a.getRequestMessageTypes().forEach(function(d){var e=a.requestMessages[d];e instanceof Array?e.forEach(function(e){l.responseHandlers[c]&&(l._shouldHandle(a,d,f)&&e.uuid===b.uuid)&&(l.responseHandlers[c]([b],a.context),m=!0)}):l.responseHandlers[c]&&(l._shouldHandle(a,d,f)&&e.uuid===b.uuid)&&(l.responseHandlers[c]([b],a.context),m=!0)});m||h.push(b)}else h.push(b)},this);if(0<h.length&&this.responseHandlers[d]&&
this._shouldHandle(a,d))this.responseHandlers[d](h,a.context);if(this.responseHandlers["*"])this.responseHandlers["*"](d,a.responseMessages[d],a.context)}}catch(l){c.error("Remote: Fault occurred while processing response.\nMessage: "+l.message+"\nType: "+d+"\nResponse: "+b.toJson(f))}},this);this._processUdcResponses(a);a.fault&&this.faultManager.handleFault(a)},_processUdcResponses:function(a){if(!d.isEndpointMessageContainerBased(a.endPointName)){var b=Object.keys(a.requestMessages)[0];if(this.responseHandlers[b]&&
this._shouldHandle(a,b,""))this.responseHandlers[b](a.responseMessages)}},_processFault:function(a){this.faultManager.handleFault(a)},_shouldHandle:function(a,b,c){return this._shouldIgnoreMessageType(a,b,c)?!1:this.transactions&&l.every(this.transactions,function(d){var f,h;if(c)for(f in d.uuidClassifierMap){if(d.uuidClassifierMap.hasOwnProperty(f)&&c&&d.uuidClassifierMap[f]===c){h=!0;break}}else h=d.requestMessages[b]?l.every(d.requestMessages[b],function(a){return!d.uuidClassifierMap[a.uuid]}):
!0;(f=!(d.requestMessages[b]&&h&&d.startTime>a.startTime))&&d.addIgnoreMessageType(b,c);return f},this)},_shouldIgnoreMessageType:function(a,b,c){return-1!==a.ignoreMessageTypes.indexOf(c?b+":"+c:b)}})})},"MW/remote/serviceRegistryLookup":function(){define(["dojo/request/xhr","require"],function(l,h){var f=!1,b={_serviceData:{},getServiceRegistryEndpoint:function(a){if(b._serviceData.serviceregistry){var c,d;c=b._serviceData.serviceregistry.length;for(d=0;d<c;d+=1)if(b._serviceData.serviceregistry[d].name===
a)return b._serviceData.serviceregistry[d].endpoint}return""}};return{load:function(a,c,d){f?d(b):l("/serviceregistrylookup/1/service",{handleAs:"json",failOk:!0,method:"GET",timeout:15E3,sync:!c.async}).then(function(a){b._serviceData=a;f=!0;d(b)},function(a){b._serviceData={};f=!0;d(b)})}}})},"MW/utils/statemachineimpl/TimeoutTrigger":function(){define(["dojo/_base/declare","dojo/_base/lang","MW/Log","./Trigger"],function(l,h,f,b){return l(b,{constructor:function(){var a=this.name.split(" ");(2>
a.length||"timeout"!==a[0])&&f.error("Invalid trigger name for a TimeoutTrigger. Could not parse out the type of handler.");this.timeoutInSeconds=parseFloat(a[1]);this.handlerType=a[0]},enable:function(){this.disable();this.timeoutHandle=setTimeout(h.hitch(null,this.triggerHandler,this.name),1E3*this.timeoutInSeconds)},disable:function(){this.timeoutHandle&&(clearTimeout(this.timeoutHandle),this.timeoutHandle=null)}})})},"MW/utils/statemachineimpl/Transition":function(){define(["dojo/_base/declare",
"dojo/_base/lang","MW/Log"],function(l,h,f){return l([],{constructor:function(b){this.state={};this.target="";this.action=this.condition=null;l.safeMixin(this,b)},handleTrigger:function(b,a){var c="";this.checkCondition(b,a)&&(this.runAction(b,a),c=this.getTarget(b,this.target,a));return c},checkCondition:function(b,a){return!this.condition?!0:h.hitch(this.state.context,this.condition).apply(null,[b,this.state.data].concat(a))},runAction:function(b,a){var c;this.action&&(c=h.hitch(this.state.context,
this.action),c.apply(null,[b,this.state.data].concat(a)))},getTarget:function(b,a,c){var d,g,e;if(h.isString(a))g=a;else if(h.isFunction(a))a=h.hitch(this.state.context,a),g=a.apply(null,[b,this.state.data].concat(c));else if(h.isArray(a))for(d=0;d<a.length;d+=1){g=this.getTarget(b,a[d],c);if(h.isString(g)){g={target:g};h.mixin(g,e);break}if(g&&g.target){h.mixin(g,e);break}e=g||{}}else f.warn("Transition: improper target: ",a);return g}})})},"MW/remote/messageserviceimpl/MessageServiceState":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/Deferred dojo/promise/all MW/utils/StateMachine MW/Log".split(" "),
function(l,h,f,b,a,c,d){return l([],{_MAX_RETRIES:30,logStateChanges:!1,constructor:function(){this._stateOptions={context:this,name:"WraDataService",namespace:"MOTW.wra",defaultSubstate:"disconnected",substates:{disconnected:{transitions:{onEnterState:this._enterDisconnected,start:"connecting"}},connecting:{transitions:{onEnterState:this._enterConnecting,_connectSuccess:"resubscribing",_connectFailure:"reconnecting","timeout 10":[this._timeoutAction,"reconnecting"],stop:"disconnected"}},reconnecting:{transitions:{onEnterState:this._enterReconnecting,
_connectSuccess:"resubscribing",_connectFailure:[this._retryFailure,"retryDelay"],"timeout 10":[this._timeoutAction,"reconnecting"],stop:"disconnected"}},retryDelay:{transitions:{"timeout 2":"reconnecting",_reconnect:"reconnecting",stop:"disconnected"}},resubscribing:{transitions:{onEnterState:this._enterResubscribing,_resubscribeSuccess:"connected",_resubscribeFailure:"reconnecting","timeout 10":[this._timeoutAction,"reconnecting"],stop:"disconnecting"}},connected:{transitions:{onEnterState:this._enterConnected,
_reconnect:"reconnecting",stop:"disconnecting"}},disconnecting:{transitions:{onEnterState:this._enterDisconnecting,_disconnectSuccess:"disconnected",_disconnectFailure:"disconnected","timeout 2":"disconnected"}},fatallyDisconnected:{transitions:{onEnterState:this._enterFatallyDisconnected,stop:"disconnected"}}}}},setDelegate:function(a){if(this._delegate!==a){this._delegate=a;var b=this;f.after(a,"onConnectionError",function(){d.warn("MessageService received connection error, reconnecting");b._reconnect()},
!0);this._states=new c(this._stateOptions);f.after(this._states,"onEnterState",h.hitch(this,this._enterState),!0);this._states.start()}},onConnected:function(){},onNewlyConnected:function(){},onDisconnected:function(){},onReconnected:function(){},onFatallyDisconnected:function(){},onNotConnected:function(){},isStarted:function(){return"disconnecting"!==this._currentState&&"disconnected"!==this._currentState},isConnected:function(){return"connected"===this._currentState},isFatallyDisconnected:function(){return"fatallyDisconnected"===
this._currentState},isDisconnected:function(){return"disconnected"===this._currentState},start:function(){},stop:function(){},_enterState:function(a){var b=this._currentState;this._currentState=a;this.logStateChanges&&d.info("MessageService state change: "+b+" -\x3e "+a);if("connected"===b)this.onNotConnected();if("connected"===a&&this._previouslyConnected)this.onReconnected();else if("connected"===a&&!this._previouslyConnected)this.onNewlyConnected()},_enterDisconnected:function(){this._previouslyConnected=
!1;this._delegate.cleanup();this.onDisconnected()},_enterConnecting:function(){this._retryCount=0;this._delegate.connect().then(this._connectSuccess,this._connectFailure)},_enterReconnecting:function(){this._retryCount+=1;d.info("Reconnecting message service. Attempt "+this._retryCount,arguments);this._delegate.cleanup();this._delegate.connect().then(this._connectSuccess,this._connectFailure)},_reconnect:function(){},_connectSuccess:function(){},_connectFailure:function(){},_timeoutAction:function(){this.logStateChanges&&
d.info("MessageService timeout:",arguments)},_retryFailure:function(){var a;this._retryCount>=this._MAX_RETRIES&&(d.error("Message service fatally disconnected."),a="fatallyDisconnected");return a},_enterResubscribing:function(){function b(a){f.push(this._delegate.doSubscribe(a.channel))}var c,d,f=[];this._delegate.doStartBatch();for(c in this.channelSubscriptions)this.channelSubscriptions.hasOwnProperty(c)&&(d=this.channelSubscriptions[c],d.forEach(b,this));this._delegate.doEndBatch();a(f).then(this._resubscribeSuccess,
this._resubscribeFailure)},_resubscribeSuccess:function(){},_resubscribeFailure:function(){},_enterConnected:function(){this._delegate.delegateConnected()?(this._retryCount=0,this._previouslyConnected&&d.info("Successfully connected."),this._previouslyConnected=!0,this.onConnected()):this._reconnect()},_enterFatallyDisconnected:function(){this.onFatallyDisconnected()},_enterDisconnecting:function(){this._delegate.disconnect().then(this._disconnectSuccess,this._disconnectFailure)},_disconnectSuccess:function(){},
_disconnectFailure:function(){}})})},"dojo/promise/all":function(){define(["../_base/array","../Deferred","../when"],function(l,h,f){var b=l.some;return function(a){var c,d;a instanceof Array?d=a:a&&"object"===typeof a&&(c=a);var g,e=[];if(c){d=[];for(var l in c)Object.hasOwnProperty.call(c,l)&&(e.push(l),d.push(c[l]));g={}}else d&&(g=[]);if(!d||!d.length)return(new h).resolve(g);var n=new h;n.promise.always(function(){g=e=null});var p=d.length;b(d,function(a,b){c||e.push(b);f(a,function(a){n.isFulfilled()||
(g[e[b]]=a,0===--p&&n.resolve(g))},n.reject);return n.isFulfilled()});return n.promise}})},"MW/remote/messageserviceimpl/MessageServiceReqResp":function(){define(["dojo/_base/declare","dojo/Deferred","MW/Log"],function(l,h,f){return l([],{pollDelay:50,constructor:function(b,a){this.remote=b;this.messageService=a;this.pending=0;b.registerDefaultMessageFactory("OpaqueMessage",function(){this.pending+=1;return{opaqueMessageDOs:[]}},this);b.registerResponseHandler("OpaqueMessageResponse",function(b){this.pending-=
1;b.forEach(function(b){try{b.opaqueMessageDOs&&b.opaqueMessageDOs.forEach(a.handleMessage,a)}catch(c){f.error("Error while handling message: "+c)}});this.poll()},this)},onMessage:function(b){},onConnectionError:function(b){},connect:function(){this.enabled=!0;this.poll();return(new h).resolve()},disconnect:function(){this.enabled=!1;this.timeout&&(clearTimeout(this.timeout),this.timeout=null);return(new h).resolve()},cleanup:function(){},poll:function(){if(this.enabled&&0===this.pending){var b=this;
this.timeout=setTimeout(function(){b.pending+=1;b.remote.sendMessage({OpaqueMessage:{opaqueMessageDOs:[]}});b.timeout=null},this.pollDelay)}},doPublish:function(b,a){clearTimeout(this.timeout);this.timeout=null;this.pending+=1;this.remote.sendMessage({OpaqueMessage:{opaqueMessageDOs:[{channel:b,data:a}]}})},doSubscribe:function(b){},doUnsubscribe:function(b){},doStartBatch:function(){},doEndBatch:function(){}})})}}});
define("InstallServiceHandler/LongRunningProcessMonitor",["dojo/_base/declare","dojo/_base/lang","dojo/aspect","MW/remote/MessageService"],function(l,h,f,b){return l(null,{_APPNAME:"LongRunningProcessMonitor",constructor:function(a,c,d){this._channelId=a;this._messageCallback=c;this._cancelCallback=void 0!==d?d:c;this._lrpChannel="/"+this._APPNAME+"/"+this._channelId;f.after(b,"onConnected",h.hitch(this,this.start),!1);b.start()},start:function(){var a=this;this._started||b.subscribe(this._lrpChannel,
this._handleMessage,this).then(function(){a._subscribed=!0;a._started=!0})},stop:function(){this._started&&(b.unsubscribe(this._lrpChannel,this._handleMessage,this),this._subscribed=!1,b.stop(),this._started=!1)},sendCancelMessage:function(){b.publish(this._lrpChannel,'{"statusType":"CANCEL","statusValue":"User Cancelled"}')},isStarted:function(){return this._started},isReady:function(){return this._subscribed},_isCancelMessage:function(a){return"CANCEL"===a.StatusType},_handleMessage:function(a){var b=
this;(b._isCancelMessage(a)?function(){b._cancelCallback(a);return!0}:b._messageCallback(a))&&b.stop()}})});
//# sourceMappingURL=LongRunningProcessMonitor.js.map